<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>StaticForge - AI Image Generator</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;500;700&family=Oxanium:wght@300;400;500;600;700&family=Share+Tech+Mono&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="pin-modal.css">
    <script src="/scripts/comp/tagSets.js"></script>
    <link rel="stylesheet" href="/fontawesome/css/fontawesome.min.css">
    <link rel="stylesheet" href="/fontawesome/css/all.min.css">
</head>
<body>
<!-- Background layers for smooth transitions -->
<div class="bokeh-background current-bg"></div>
<div class="bokeh-background next-bg" style="opacity: 0;"></div>

<svg class="bokeh" viewBox="0 0 10 10" xmlns="http://www.w3.org/2000/svg">
  <circle cx="10%" cy="85%" r="60%"  />
  <circle cx="45%" cy="50%" r="12%"  />
  <circle cx="85%" cy="35%" r="25%"  />
  <circle cx="60%" cy="85%" r="16%"  />
  <circle cx="45%" cy="50%" r="24%"  />
  <circle cx="35%" cy="25%" r="16%"  />
  <circle cx="90%" cy="-25%" r="28%" />
  <circle cx="-15%" cy="30%" r="24%" />
  <circle cx="65%" cy="85%" r="44%"  />
  <circle cx="45%" cy="50%" r="16%"  />
  <circle cx="25%" cy="75%" r="20%"  />
  <circle cx="75%" cy="15%" r="18%"  />
  <circle cx="15%" cy="15%" r="22%"  />
  <circle cx="80%" cy="70%" r="14%"  />
  <circle cx="5%" cy="45%" r="26%"  />
</svg>
    <!-- Character Autocomplete Overlay -->
    <div id="characterAutocompleteOverlay" class="character-autocomplete-overlay hidden">
        <div class="character-autocomplete-list">
            <!-- Character suggestions will be populated here -->
        </div>
    </div>

    <!-- Preset Autocomplete Overlay -->
    <div id="presetAutocompleteOverlay" class="preset-autocomplete-overlay hidden size-small">
        <div class="preset-autocomplete-list">
            <!-- Preset suggestions will be populated here -->
        </div>
    </div>

    <!-- Header -->
    <header class="header">
        <div class="header-left">
            <span class="menu-logo">
                <i class="nai-wand-sparkles"></i>
                <span class="logo-text">StaticForge</span>
            </span>
            <!-- Workspace Dropdown -->
            <div id="workspaceDropdown" class="custom-dropdown">
                <button type="button" id="workspaceDropdownBtn" class="btn-secondary">
                    <i class="fas fa-folder"></i>
                    <span id="workspaceSelected">Default</span>
                </button>
                <div id="workspaceDropdownMenu" class="custom-dropdown-menu" style="display: none;">
                    <!-- Workspace options will be populated here -->
                </div>
            </div>
            <div id="galleryToggleGroup" class="gallery-toggle-group" title="Gallery View">
                <button type="button" class="gallery-toggle-btn" data-view="scraps" title="Scraps">
                    <i class="nai-image-tool-sketch"></i>
                </button>
                <button type="button" class="gallery-toggle-btn active" data-view="images" title="Images">
                    <i class="nai-image-count"></i>
                </button>
                <button type="button" class="gallery-toggle-btn" data-view="pinned" title="Pinned">
                    <i class="nai-heart-enabled"></i>
                </button>
                <button type="button" class="gallery-toggle-btn" data-view="upscaled" title="Upscaled">
                    <i class="nai-upscale"></i>
                </button>
                <div class="gallery-toggle-slider"></div>
            </div>
            <input type="number" id="galleryColumnsInput" class="form-control hover-show colored" min="3" max="10" value="5" style="width: 42px;">
        </div>
        <div class="header-controls">
            <div id="customPresetDropdown" class="custom-dropdown">
                <div class="button-group">
                <button type="button" id="customPresetDropdownBtn" class="btn-secondary">
                    <span id="customPresetSelected"><i class="fas fa-book-spells"></i> Spellbook</span>
                </button>
                <button id="generateBtn" class="btn-primary" disabled>
                    <i class="nai-sparkles"></i>
                </button>
                </div>
                <div id="customPresetDropdownMenu" class="custom-dropdown-menu" style="display: none;"></div>
            </div>
            <input type="hidden" id="presetSelect" value="">
            <button id="manualBtn" class="btn-secondary">
                <span class="btn-text">Creator</span><i class="nai-pen-tip-light"></i>
            </button>
            <div class="workspace-controls">
                <!-- Workspace Action Buttons -->
                <button type="button" id="workspaceManageBtn" class="btn-secondary" title="Manage Workspaces">
                    <i class="fas fa-hammer-brush"></i>
                </button>
                <button type="button" id="cacheManagerBtn" class="btn-secondary" title="Reference Manager">
                    <i class="fas fa-swatchbook"></i>
                </button>
                <button id="uploadBtn" class="btn-secondary" title="Upload Images (or paste from clipboard)">
                    <i class="fas fa-file-import"></i>
                </button>
            </div>
            
            <div id="queueStatus" class="inset-badge queue-status" title="Flow Control and Generated Images Counter">
                <i id="queueIcon" class="fas fa-spinner fa-spin"></i>
                <span id="imageGenCounter" class="image-gen-counter">---</span>
            </div>
            <div id="balanceDisplay" class="inset-badge balance-display" title="Loading balance...">
                <i class="nai-anla"></i>
                <span id="balanceAmount">---</span>
            </div>
            <button id="logoutButton" class="btn-primary">
                <i class="nai-logout"></i>
            </button>
        </div>
    </header>

    <!-- Error Sub-Header -->
    <div id="errorSubHeader" class="error-sub-header hidden">
        <div class="error-sub-header-content">
            <div class="error-sub-header-left">
                <i class="error-sub-header-icon"></i>
                <span class="error-sub-header-text"></span>
            </div>
            <div class="error-sub-header-right">
                <button type="button" class="error-sub-header-close" title="Dismiss">
                    <i class="fas fa-times"></i>
                </button>
            </div>
        </div>
    </div>

    <!-- Main Container -->
    <div class="container">
        <!-- Manual Generation Modal -->
        <div id="manualModal" class="modal">
            <div class="modal-content manual-modal-content">
                <div class="manual-modal-split">
                    <div class="manual-modal-form-section">
                        <form id="manualForm">
                            <div class="form-section form-section-scroll">
                                <div class="form-group">
                                    <div class="prompt-tabs">
                                        <div class="tab-header">
                                            <div id="tab-buttons" class="gallery-toggle-group" data-active="prompt">
                                                <button type="button" class="gallery-toggle-btn active" data-tab="prompt" title="Base Prompt">
                                                    <i class="nai-penwriting"></i>
                                                </button>
                                                <button type="button" class="gallery-toggle-btn" data-tab="uc" title="Undesired Content">
                                                    <i class="nai-minus"></i>
                                                </button>
                                                <button type="button" class="gallery-toggle-btn" data-tab="settings" title="Dataset Settings">
                                                    <i class="nai-settings"></i>
                                                </button>
                                                <div class="gallery-toggle-slider"></div>
                                            </div>
                                            <div class="extra-buttons">
                                                <!-- Dataset Dropdown -->
                                                <div id="datasetDropdown" class="custom-dropdown dropdown dropright">
                                                    <button type="button" id="datasetDropdownBtn" class="btn-secondary toggle-btn" data-state="off" title="Dataset Selection">
                                                        <i id="datasetIcon" class="nai-sakura"></i>
                                                        <span id="datasetSelected" class="badge hidden"></span>
                                                    </button>
                                                    <div id="datasetDropdownMenu" class="custom-dropdown-menu" style="display: none;"></div>
                                                </div>
                                                
                                                <!-- Quality Toggle -->
                                                <button type="button" id="qualityToggleBtn" class="btn-secondary toggle-btn" data-state="off" title="Enable Quality Enhancements">
                                                    <i class="fa-chess-king fas"></i>
                                                </button>
                                                
                                                <!-- UC Presets Dropdown -->
                                                <div id="ucPresetsDropdown" class="custom-dropdown dropdown dropright">
                                                    <button type="button" id="ucPresetsDropdownBtn" class="btn-secondary toggle-btn" data-state="off" title="UC Presets">
                                                        <div class="uc-boxes">
                                                            <div class="uc-box" data-level="1"></div>
                                                            <div class="uc-box" data-level="2"></div>
                                                            <div class="uc-box" data-level="3"></div>
                                                        </div>
                                                    </button>
                                                    <div id="ucPresetsDropdownMenu" class="custom-dropdown-menu" style="display: none;"></div>
                                                </div>

                                                <button type="button" class="show-both-btn" id="showBothBtn" title="Show both panes">
                                                    <i class="nai-detatch-up"></i>
                                                </button>
                                            </div>
                                        </div>
                                        <div class="tab-content">
                                            <div class="tab-pane active" id="prompt-tab" data-label="Base Prompt">
                                                <div class="prompt-textarea-container">
                                                    <div class="prompt-textarea-background"></div>
                                                    <textarea id="manualPrompt" class="form-control prompt-textarea textarea-inset" placeholder="Enter your prompt..." required  autocapitalize="false" autocorrect="false" spellcheck="false" data-ms-editor="false"></textarea>
                                                </div>
                                            </div>
                                            <div class="tab-pane" id="uc-tab" data-label="Undesired Content">
                                                <div class="prompt-textarea-container">
                                                    <div class="prompt-textarea-background"></div>
                                                    <textarea id="manualUc" class="form-control prompt-textarea textarea-inset" rows="3" placeholder="Enter undesired content..."  autocapitalize="false" autocorrect="false" spellcheck="false" data-ms-editor="false"></textarea>
                                                </div>
                                            </div>
                                            <div class="tab-pane" id="settings-tab" data-label="Dataset Settings">
                                                <div class="dataset-bias-container">
                                                    <!-- Dataset bias inputs will be dynamically populated here -->
                                                    <div id="datasetBiasControls">
                                                        <!-- Dynamic content -->
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Character Prompts Section -->
                                <div class="form-group">
                                    <div class="character-prompts-header">
                                        <div class="character-prompts-title-group">
                                            <button type="button" id="randomPromptToggleBtn" class="btn-secondary toggle-btn" data-state="off" title="Random Prompt">
                                                <i class="nai-dice"></i>
                                            </button>
                                            <button type="button" id="randomPromptRefreshBtn" class="btn-secondary" title="Generate new random prompt" style="display: none;">
                                                <i class="nai-reload"></i>
                                            </button>
                                            <button type="button" id="randomPromptNsfwBtn" class="btn-secondary toggle-btn" data-state="off" title="Toggle NSFW content" style="display: none;">
                                                NSFW
                                            </button>
                                            <button type="button" id="randomPromptTransferBtn" class="btn-secondary" title="Transfer random prompt to main prompt and exit random mode" style="display: none;">
                                                <i class="nai-export"></i>
                                            </button>
                                        </div>
                                        <div class="character-prompts-controls">
                                            <button type="button" id="autoPositionBtn" class="btn-secondary toggle-btn" data-state="on" title="Auto Position" style="display: none;">
                                                <i class="fas fa-arrows-up-down-left-right"></i> Auto
                                            </button>
                                            <button type="button" id="vibeNormalizeToggle" class="btn-secondary toggle-btn" data-state="on" title="Normalize vibe strengths">
                                                <i class="fas fa-scale-balanced"></i>
                                            </button>
                                            <!-- Custom Transformation Dropdown -->
                                            <input type="hidden" id="transformationType" value="reroll">
                                            <div id="transformationDropdown" class="custom-dropdown dropright">
                                                <button type="button" id="transformationDropdownBtn" class="btn-secondary toggle-btn" data-state="off">
                                                    <i class="nai-img2img"></i>
                                                    <span id="transformationSelected">Reference</span>
                                                </button>
                                                <div id="transformationDropdownMenu" class="custom-dropdown-menu" style="display: none;">
                                                    <div class="custom-dropdown-option" data-value="browse">
                                                        <i class="fas fa-folder-image"></i> Browse
                                                    </div>
                                                    <div class="custom-dropdown-option" data-value="upload">
                                                        <i class="nai-import"></i> Upload
                                                    </div>
                                                    <div class="custom-dropdown-option" data-value="reroll" style="display: none;">
                                                        <i class="nai-img2img"></i> Previous
                                                    </div>
                                                    <div class="custom-dropdown-option" data-value="variation" style="display: none;">
                                                        <i class="nai-img2img"></i> Current
                                                    </div>
                                                </div>
                                            </div>
                                            <button type="button" id="addCharacterBtn" class="btn-secondary">
                                                <i class="nai-plus"></i> Character
                                            </button>
                                        </div>
                                    </div>
                                    <div id="characterPromptsContainer" class="character-prompts-container">
                                    </div>
                                </div>
                                
                                <div id="transformationRow" class="transforms-container form-row">
                                    <!-- Transformation Section -->
                                    <div id="transformationSection" class="transformation-image-container">
                                        <div class="overlay-buttons-container">
                                            <button type="button" id="inpaintBtn" class="btn-secondary toggle-btn blur" data-state="off">
                                                <i class="nai-inpaint"></i>
                                            </button>
                                            <button type="button" id="deleteImageBaseBtn" class="btn-secondary blur" style="display: none;">
                                                <i class="nai-thin-cross"></i>
                                            </button>
                                        </div>
                                        <div class="variation-image-container">
                                            <img id="manualVariationImage" src="" alt="Source Image" class="variation-image">
                                            <canvas id="maskPreviewCanvas" class="mask-preview-canvas" style="pointer-events: none;"></canvas>
                                                
                                            <div class="overlay-icon-container">
                                                <i class="nai-img2img"></i>
                                            </div>
                                        </div>
                                        <div id="imageBiasGroup" class="vibe-reference-info">
                                            <!-- Custom Image Bias Dropdown -->
                                            <div id="imageBiasDropdown" class="custom-dropdown dropup">
                                                <button type="button" id="imageBiasDropdownBtn" class="custom-dropdown-btn hover-show colored">
                                                    <div class="mask-bias-button-content">
                                                        <div class="mask-bias-grid" data-bias="2" data-orientation="landscape">
                                                            <div class="grid-cell"></div>
                                                            <div class="grid-cell"></div>
                                                            <div class="grid-cell"></div>
                                                            <div class="grid-cell"></div>
                                                            <div class="grid-cell"></div>
                                                            <div class="grid-cell"></div>
                                                            <div class="grid-cell"></div>
                                                            <div class="grid-cell"></div>
                                                            <div class="grid-cell"></div>
                                                            <div class="grid-cell"></div>
                                                            <div class="grid-cell"></div>
                                                            <div class="grid-cell"></div>
                                                            <div class="grid-cell"></div>
                                                            <div class="grid-cell"></div>
                                                            <div class="grid-cell"></div>
                                                            <div class="grid-cell"></div>
                                                            <div class="grid-cell"></div>
                                                            <div class="grid-cell"></div>
                                                            <div class="grid-cell"></div>
                                                            <div class="grid-cell"></div>
                                                            <div class="grid-cell"></div>
                                                            <div class="grid-cell"></div>
                                                            <div class="grid-cell"></div>
                                                        </div>
                                                        <span id="imageBiasSelected">Center</span>
                                                    </div>
                                                </button>
                                                <div id="imageBiasDropdownMenu" class="custom-dropdown-menu" style="display: none;"></div>
                                            </div>
                                            <!-- Advanced Bias Adjustment Button -->
                                            <button type="button" id="imageBiasAdjustBtn" class="btn-secondary" title="Advanced Bias Adjustment">
                                                <i class="nai-resize"></i>
                                            </button>
                                            <input type="hidden" id="imageBias" value="2">
                                        </div>
                                    </div>
                                    <div id="vibeReferencesContainer" class="vibe-references-container">
                                        <!-- Vibe reference items will be added here -->
                                    </div>
                                </div>
                            </div>
                            
                            <div class="form-section model-control">
                                <div class="form-row">
                                    <div class="form-group" id="manualModelGroup">
                                        <label for="manualModel">Model</label>
                                        <div id="manualModelDropdown" class="custom-dropdown dropup">
                                            <button type="button" id="manualModelDropdownBtn" class="custom-dropdown-btn hover-show colored">
                                                <span id="manualModelSelected">Select model...</span>
                                            </button>
                                            <div id="manualModelDropdownMenu" class="custom-dropdown-menu" style="display: none;"></div>
                                        </div>
                                        <input type="hidden" id="manualModel" value="">
                                    </div>
                                    <div class="form-group">
                                        <label for="manualSteps">Steps</label>
                                        <input type="number" id="manualSteps" class="form-control hover-show colored" min="1" max="28" value="25" placeholder="25">
                                    </div>
                                    <div class="form-group">
                                        <label for="manualGuidance">Guidance</label>
                                        <div class="guidance-group" style="display: flex; align-items: center; gap: 6px;">
                                            <input type="number" id="manualGuidance" class="form-control hover-show colored" min="0.0" max="10.0" step="0.01" value="5.0" placeholder="5.0">
                                            <button type="button" id="varietyBtn" class="btn-secondary toggle-btn" title="Enable Variety+">
                                                <i class="fas fa-sparkle"></i>
                                            </button>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label for="manualRescale">Rescale</label>
                                        <input type="number" id="manualRescale" class="form-control hover-show colored" min="0.0" max="1.0" step="0.01" value="0.0" placeholder="0.0">
                                    </div>
                                    <div id="manualResolutionGroup" class="form-group">
                                        <label for="manualResolution">Resolution</label>
                                        <div class="resolution-group">
                                            <div id="manualResolutionDropdown" class="custom-dropdown dropup">
                                                <button type="button" id="manualResolutionDropdownBtn" class="custom-dropdown-btn hover-show colored">
                                                    <span id="manualResolutionSelected">Select resolution...</span>
                                                </button>
                                                <div id="manualResolutionDropdownMenu" class="custom-dropdown-menu" style="display: none;"></div>
                                            </div>
                                            <input type="hidden" id="manualResolution" value="">
                                            <div id="manualCustomResolution" class="custom-resolution-inputs" style="display: none;">
                                                <button type="button" id="manualCustomResolutionBtn" class="btn-secondary toggle-btn" data-state="off" title="Custom Resolution">
                                                    <i class="fas fa-ruler-combined"></i>
                                                </button>
                                                <input type="number" id="manualWidth" class="colored form-control hover-show" placeholder="Width" min="512" max="2048" step="8">
                                                <span style="color: #ccc; padding-bottom: 5px;">Ã—</span>
                                                <input type="number" id="manualHeight" class="colored form-control hover-show" placeholder="Height" min="512" max="2048" step="8">
                                            </div>
                                            <button type="button" id="manualUpscale" class="btn-secondary toggle-btn" data-state="off" title="Enable upscaling">
                                                <i class="nai-upscale"></i>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                                <div class="form-row">
                                    <div id="manualStrengthGroup" class="form-group" style="flex: unset;">
                                        <label for="manualStrength"><i class="nai-img2img"></i>Strength</label>
                                        <input type="number" id="manualStrengthValue" class="form-control hover-show colored slider-value-input" min="0.0" max="1.0" step="0.01" value="0.8" style="width: 60px; margin-right: 10px;" tabindex="0">
                                    </div>
                                    <div id="manualNoiseGroup" class="form-group" style="flex: unset;">
                                        <label for="manualNoise"><i class="nai-img2img"></i> Noise</label>
                                        <input type="number" id="manualNoiseValue" class="form-control hover-show colored slider-value-input" min="0.0" max="1.0" step="0.01" value="0.1" style="width: 60px; margin-right: 10px;" tabindex="0">
                                    </div>
                                    <div class="form-group">
                                        <label for="manualSampler">Sampler</label>
                                        <!-- Custom Manual Sampler Dropdown -->
                                        <div id="manualSamplerDropdown" class="custom-dropdown dropup">
                                            <button type="button" id="manualSamplerDropdownBtn" class="custom-dropdown-btn hover-show colored">
                                                <span id="manualSamplerSelected">Select sampler...</span>
                                            </button>
                                            <div id="manualSamplerDropdownMenu" class="custom-dropdown-menu" style="display: none;"></div>
                                        </div>
                                        <input type="hidden" id="manualSampler" value="">
                                    </div>
                                    <div class="form-group">
                                        <label for="manualNoiseScheduler">Noise Sch.</label>
                                        <!-- Custom Manual Noise Scheduler Dropdown -->
                                        <div id="manualNoiseSchedulerDropdown" class="custom-dropdown dropup">
                                            <button type="button" id="manualNoiseSchedulerDropdownBtn" class="custom-dropdown-btn hover-show colored">
                                                <span id="manualNoiseSchedulerSelected">Select noise scheduler...</span>
                                            </button>
                                            <div id="manualNoiseSchedulerDropdownMenu" class="custom-dropdown-menu" style="display: none;"></div>
                                        </div>
                                        <input type="hidden" id="manualNoiseScheduler" value="">
                                    </div>
                                    <div class="form-group" style="flex: unset;">
                                        <label for="manualSeed">Seed</label>
                                        <div class="seed-input-group">
                                            <button type="button" id="editSeedBtn" class="btn-secondary toggle-btn" data-state="off" title="Edit seed">
                                                <i class="nai-seed"></i>
                                            </button>
                                            <input type="number" id="manualSeed" class="form-control hover-show colored" placeholder="Randomize" style="width: 125px;">
                                            <button type="button" id="sproutSeedBtn" class="btn-secondary toggle-btn" data-state="off" title="Fill with seed value" style="display: none;">
                                                <i class="fas fa-clipboard"></i>
                                            </button>
                                            <button type="button" id="clearSeedBtn" class="btn-secondary" title="Clear seed">
                                                <i class="nai-thin-cross"></i>
                                            </button>
                                        </div>
                                    </div>
                                </div>

                                <div id="manualPresetGroup" class="form-row">
                                    <div class="form-group">
                                        <label for="manualPresetName">Preset Name</label>
                                        <input type="text" id="manualPresetName" class="form-control hover-show colored" placeholder="Enter preset name to save..." autocorrect="false"  autocapitalize="false">
                                    </div>
                                    <div class="form-group" style="flex: unset;">
                                        <label>&nbsp;</label>
                                        <button type="button" id="manualLoadBtn" class="btn-secondary" disabled>
                                            <i class="nai-import"></i> Load
                                        </button>
                                    </div>
                                    <div class="form-group" style="flex: unset;">
                                        <label>&nbsp;</label>
                                        <button type="button" id="manualSaveBtn" class="btn-secondary">
                                            <i class="nai-save"></i> Save
                                        </button>
                                    </div>
                                </div>

                                <div class="form-actions btn-group">
                                    <div class="footer-left">
                                        <div id="manualPriceDisplay" class="inset-badge price-display" style="display: none;">
                                            <i class="nai-anla"></i>
                                            <span id="manualPriceList" class="price-list">-</span>
                                        </div>
                                        <button type="button" id="paidRequestToggle" class="btn-secondary toggle-btn" data-state="off" title="Force Paid Request">
                                            <i class="fas fa-dollar-sign"></i>
                                        </button>
                                        <!-- Preset Toggle Button -->
                                        <button type="button" id="manualPresetToggleBtn" class="btn-secondary hover-show" data-state="off">
                                            <span id="manualPresetToggleText"></span>
                                            <i id="manualPresetToggleIcon" class="fas fa-pen-field"></i>
                                        </button>
                                    </div>
                                    <button type="button" id="closeManualBtn" class="btn-secondary">Cancel</button>
                                    <button type="submit" id="manualGenerateBtn" class="btn-primary">
                                        <span>Generate</span>
                                        <i class="nai-sparkles"></i>
                                    </button>
                                </div>
                            </div>
                        </form>
                    </div>
                    <div class="manual-preview-handle">
                        <div id="manualPreviewHandle" class="manual-preview-handle-inner">
                            <i class="fas fa-grip-lines"></i>
                        </div>
                    </div>
                    <div class="manual-modal-preview-section" id="manualPanelSection">
                        <div class="manual-preview-container" id="manualPreviewContainer">
                            <!-- Manual Modal Loading Overlay -->
                            <div id="manualLoadingOverlay" class="manual-loading-overlay hidden return">
                                <div class="manual-loading-content">
                                    <div class="spinner"></div>
                                    <p>Generating your image...</p>
                                </div>
                            </div>
                            <div class="manual-preview-content">
                                <!-- Navigation buttons -->
                                <div class="manual-preview-image-container">
                                    <!-- Original image (shown on the right when editing) -->
                                    <img id="manualPreviewOriginalImage" src="" alt="Original Image" class="manual-preview-original-image" style="display: none;">
                                    <!-- Generated image (shown on the left) -->
                                    <img id="manualPreviewImage" src="" alt="Generated Image" style="display: none;">
                                    <div id="manualPreviewPlaceholder" class="manual-preview-placeholder">
                                        <i class="nai-image-placeholder-odd"></i>
                                        <p>Generate an image to see preview</p>
                                    </div>
                                </div>
                                <div class="manual-preview-controls">
                                    <button id="manualPreviewDownloadBtn" class="btn-secondary round-button blur" style="display: none;">
                                        <i class="nai-save"></i>
                                    </button>
                                    <button id="manualPreviewPinBtn" class="btn-secondary round-button blur" style="display: none;">
                                        <i class="nai-heart-disabled"></i>
                                    </button>
                                    <button id="manualPreviewUpscaleBtn" class="btn-secondary round-button blur" style="display: none;">
                                        <i class="nai-upscale"></i>
                                    </button>
                                    <button id="manualPreviewVariationBtn" class="btn-secondary round-button blur" style="display: none;">
                                        <i class="nai-inpaint"></i>
                                    </button>
                                    <button id="manualPreviewLoadBtn" class="btn-secondary round-button blur" style="display: none;">
                                        <i class="nai-penwriting"></i>
                                    </button>
                                    <div class="round-button-group">
                                        <button id="manualPreviewScrapBtn" class="btn-secondary round-button blur" style="display: none;">
                                            <i class="nai-image-tool-sketch"></i>
                                        </button>
                                        <button id="manualPreviewDeleteBtn" class="btn-danger round-button blur" style="display: none;">
                                            <i class="nai-trash"></i>
                                        </button>
                                    </div>
                                </div>
                                <div class="manual-preview-controls-top-right">
                                    <button id="manualPreviewCloseBtn" class="btn-secondary round-button blur">
                                        <i class="nai-thin-cross"></i>
                                    </button>
                                </div>
                                <div class="manual-preview-controls-left">
                                    <button id="manualPreviewPrevBtn" class="btn-secondary round-button blur" disabled>
                                        <i class="nai-directional-arrow-left"></i>
                                    </button>
                                    <button id="manualPreviewNextBtn" class="btn-secondary round-button blur" disabled>
                                        <i class="nai-directional-arrow-right"></i>
                                    </button>
                                </div>
                                <div class="manual-preview-controls-right">
                                    <div id="manualPreviewSeedBtn" class="btn-secondary round-button blur">
                                        <i class="nai-seed"></i>
                                        <span id="manualPreviewSeedNumber">---</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!-- Reference Browser Container (Desktop Only) -->
                        <div id="cacheBrowserContainer" class="cache-browser-container">
                            <div class="cache-browser-header">
                                <!-- Tab Navigation -->
                                <div class="cache-browser-tabs">
                                    <div class="gallery-toggle-group" data-active="references">
                                        <button type="button" class="gallery-toggle-btn active" data-tab="references" data-title="Base Images">
                                            <i class="fas fa-images"></i>
                                        </button>
                                        <button type="button" class="gallery-toggle-btn" data-tab="vibe-references" data-title="Vibe References">
                                            <i class="nai-vibe-transfer"></i>
                                        </button>
                                        <div class="gallery-toggle-slider"></div>
                                    </div>
                                    <span id="cacheBrowserTabTitle" class="tab-text">Base Images</span>
                                </div>
                                <button id="closeCacheBrowserContainerBtn" class="close-dialog">&times;</button>
                            </div>
                            <div class="cache-browser-body">
                                
                                <!-- References Tab -->
                                <div class="tab-pane active" id="references-tab-container">
                                    <div id="cacheGalleryContainer" class="cache-gallery">
                                        <!-- Reference images will be loaded here -->
                                    </div>
                                    <div class="cache-browser-loading" id="cacheBrowserLoadingContainer" style="display: none;">
                                        <div class="spinner"></div>
                                        <p>Loading reference images...</p>
                                    </div>
                                </div>
                                
                                <!-- Vibe References Tab -->
                                <div class="tab-pane" id="vibe-references-tab-container">
                                    <div id="vibeReferencesGalleryContainer" class="cache-gallery">
                                        <!-- Vibe reference images will be loaded here -->
                                    </div>
                                    <div class="cache-browser-loading" id="vibeReferencesLoadingContainer" style="display: none;">
                                        <div class="spinner"></div>
                                        <p>Loading vibe references...</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    
        <!-- Gallery -->
        <div class="gallery-container">
            
            <!-- Bulk Actions Bar -->
            <div id="bulkActionsBar" class="bulk-actions-bar blur" style="display: none;">
                <div class="bulk-actions-info">
                    <span id="selectedCount">0</span> images selected
                </div>
                <div class="bulk-actions-buttons">
                    <button id="bulkSequenziaBtn" class="btn-secondary">
                        <i class="fas fa-share"></i>
                    </button>
                    <button id="bulkMoveToWorkspaceBtn" class="btn-secondary">
                        <i class="fas fa-folder"></i>
                    </button>
                    <button id="bulkMoveToScrapsBtn" class="btn-secondary">
                        <i class="nai-image-tool-sketch"></i>
                    </button>
                    <button id="bulkPinBtn" class="btn-secondary" style="display: none;">
                        <i class="nai-heart-enabled"></i>
                    </button>
                    <button id="bulkUnpinBtn" class="btn-secondary" style="display: none;">
                        <i class="nai-heart-disabled"></i>
                    </button>
                    <button id="bulkChangePresetBtn" class="btn-secondary">
                        <i class="fas fa-pen-field"></i>
                    </button>
                    <button id="bulkDeleteBtn" class="btn-danger">
                        <i class="nai-trash"></i> Delete
                    </button>
                    <button id="bulkSelectAllBtn" class="btn-secondary">
                        <i class="fas fa-check-double"></i>
                    </button>
                    <button id="clearSelectionBtn" class="btn-secondary">
                        <i class="nai-thin-cross"></i>
                    </button>
                </div>
            </div>
            
            <div id="gallery" class="gallery">
                <!-- Images will be loaded here -->
            </div>
            
            <!-- Loading indicator for infinite scroll -->
            <div id="infiniteScrollLoading" class="infinite-scroll-loading" style="display: none;">
                <div class="spinner"></div>
                <p>Loading more images...</p>
            </div>
        </div>

        <!-- Loading Overlay -->
        <div id="loadingOverlay" class="loading-overlay hidden">
            <div class="loading-content">
                <div class="spinner"></div>
                <p>Generating your image...</p>
            </div>
        </div>
    </div>

    <!-- Desktop Workspace Tabs -->
    <div id="workspaceTabs" class="workspace-tabs">
        <!-- Workspace tabs will be populated here -->
    </div>   

    <!-- Position Dialog Modal -->
    <div id="positionDialog" class="modal">
        <div class="modal-content position-dialog-content center">
            <div class="position-dialog-body">
                <div class="position-grid">
                    <div class="position-row">
                        <div class="position-cell" data-x="0.1" data-y="0.1" data-cell="A1">A1</div>
                        <div class="position-cell" data-x="0.3" data-y="0.1" data-cell="B1">B1</div>
                        <div class="position-cell" data-x="0.5" data-y="0.1" data-cell="C1">C1</div>
                        <div class="position-cell" data-x="0.7" data-y="0.1" data-cell="D1">D1</div>
                        <div class="position-cell" data-x="0.9" data-y="0.1" data-cell="E1">E1</div>
                    </div>
                    <div class="position-row">
                        <div class="position-cell" data-x="0.1" data-y="0.3" data-cell="A2">A2</div>
                        <div class="position-cell" data-x="0.3" data-y="0.3" data-cell="B2">B2</div>
                        <div class="position-cell" data-x="0.5" data-y="0.3" data-cell="C2">C2</div>
                        <div class="position-cell" data-x="0.7" data-y="0.3" data-cell="D2">D2</div>
                        <div class="position-cell" data-x="0.9" data-y="0.3" data-cell="E2">E2</div>
                    </div>
                    <div class="position-row">
                        <div class="position-cell" data-x="0.1" data-y="0.5" data-cell="A3">A3</div>
                        <div class="position-cell" data-x="0.3" data-y="0.5" data-cell="B3">B3</div>
                        <div class="position-cell" data-x="0.5" data-y="0.5" data-cell="C3">C3</div>
                        <div class="position-cell" data-x="0.7" data-y="0.5" data-cell="D3">D3</div>
                        <div class="position-cell" data-x="0.9" data-y="0.5" data-cell="E3">E3</div>
                    </div>
                    <div class="position-row">
                        <div class="position-cell" data-x="0.1" data-y="0.7" data-cell="A4">A4</div>
                        <div class="position-cell" data-x="0.3" data-y="0.7" data-cell="B4">B4</div>
                        <div class="position-cell" data-x="0.5" data-y="0.7" data-cell="C4">C4</div>
                        <div class="position-cell" data-x="0.7" data-y="0.7" data-cell="D4">D4</div>
                        <div class="position-cell" data-x="0.9" data-y="0.7" data-cell="E4">E4</div>
                    </div>
                    <div class="position-row">
                        <div class="position-cell" data-x="0.1" data-y="0.9" data-cell="A5">A5</div>
                        <div class="position-cell" data-x="0.3" data-y="0.9" data-cell="B5">B5</div>
                        <div class="position-cell" data-x="0.5" data-y="0.9" data-cell="C5">C5</div>
                        <div class="position-cell" data-x="0.7" data-y="0.9" data-cell="D5">D5</div>
                        <div class="position-cell" data-x="0.9" data-y="0.9" data-cell="E5">E5</div>
                    </div>
                </div>
                <div class="position-dialog-actions">
                    <button type="button" id="confirmPositionBtn" class="btn-primary">Confirm Position</button>
                    <button type="button" id="cancelPositionBtn" class="btn-secondary">Cancel</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Mask Editor Dialog Modal -->
    <div id="maskEditorDialog" class="modal">
        <div class="modal-content mask-editor-content">
            <div class="mask-editor-body">
                <div class="mask-editor-tools">
                    <h3>Mask Editor</h3>
                    <button type="button" id="maskBrushBtn" class="btn-secondary toggle-btn" data-state="on" title="Brush Tool">
                        <i class="nai-pen"></i> Brush
                    </button>
                    <button type="button" id="maskEraserBtn" class="btn-secondary toggle-btn" data-state="off" title="Eraser Tool">
                        <i class="nai-eraser"></i> Eraser
                    </button>
                    <button type="button" id="brushShapeBtn" class="btn-secondary" title="Toggle Brush Shape">
                        <i class="fas fa-square"></i>
                    </button>
                    <div class="brush-size-control">
                        <input type="number" id="brushSize" class="form-control hover-show colored" min="1" max="20" value="3" style="width: 50px;">
                    </div>
                    <button type="button" id="maskNegativeBtn" class="btn-secondary" title="Negative (Invert Mask)">
                        <i class="fas fa-adjust"></i> Invert
                    </button>
                    <button type="button" id="clearMaskBtn" class="btn-secondary" title="Clear Mask">
                        <i class="fas fa-trash"></i> Clear
                    </button>
                </div>
                <div class="mask-editor-canvas-container">
                    <div class="mask-editor-canvas-inner" id="maskEditorCanvasInner">
                        <canvas id="maskCanvas" width="64" height="64"></canvas>
                        <canvas id="maskBrushPreviewCanvas" width="64" height="64" style="position:absolute; left:0; top:0; pointer-events:none;"></canvas>
                    </div>
                </div>
                <div class="mask-editor-actions">
                    <button type="button" id="cancelMaskBtn" class="btn-secondary">Cancel</button>
                    <button type="button" id="deleteMaskBtn" class="btn-danger">Delete</button>
                    <button type="button" id="saveMaskBtn" class="btn-primary">Save</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Image Bias Adjustment Modal -->
    <div id="imageBiasAdjustmentModal" class="modal">
        <div class="modal-content image-bias-adjustment-content">
            <div class="image-bias-adjustment-body">
                <!-- Bias Controls Section -->
                <div class="bias-controls-section main-controls">
                    <h3>Image Bias</h3>
                    <div class="bias-controls-grid">
                        <div class="bias-control-group">
                            <label for="biasX">X Position</label>
                            <input type="number" id="biasX" class="form-control hover-show colored" min="0" max="2048" step="1" value="0">
                        </div>
                        <div class="bias-control-group">
                            <label for="biasY">Y Position</label>
                            <input type="number" id="biasY" class="form-control hover-show colored" min="0" max="2048" step="1" value="0">
                        </div>
                        <div class="bias-control-group">
                            <label for="biasScale">Scale</label>
                            <input type="number" id="biasScale" class="form-control hover-show colored" min="0.1" max="3.0" step="0.01" value="1.0">
                        </div>
                        <div class="bias-control-group">
                            <label for="biasRotate">Rotate</label>
                            <input type="number" id="biasRotate" class="form-control hover-show colored" min="-180" max="180" step="1" value="0">
                        </div>
                        <div class="bias-control-group">
                            <label>&nbsp;</label>
                            <div style="display: flex; gap: 8px; align-items: center; margin-right: auto;">
                                <div class="custom-dropdown" id="imageBiasPresetDropdown">
                                    <button type="button" class="btn-secondary" id="imageBiasPresetBtn">
                                        <span class="mask-bias-label">Preset</span>
                                    </button>
                                    <div class="custom-dropdown-menu" id="imageBiasPresetMenu" style="display: none;"></div>
                                </div>
                            </div>
                        </div>
                        <div class="bias-control-group" style="margin-left: auto;">
                            <label>&nbsp;</label>
                            <div style="display: flex; gap: 8px; align-items: center;">
                                <button type="button" id="biasResetBtn" class="btn-secondary">
                                    <i class="nai-reload"></i> Reset
                                </button>
                                <button type="button" id="previewToggleBtn" class="btn-secondary toggle-btn" data-state="on">
                                    <i class="fas fa-mouse-pointer"></i> Interactive
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Image Preview Section -->
                <div class="image-preview-section">
                    <div class="image-preview-container" id="imagePreviewContainer">
                        <div class="target-area-overlay" id="targetAreaOverlay">
                            <div class="target-area-border"></div>
                        </div>
                        <div id="biasAdjustmentImageWrapper" class="bias-adjustment-image-wrapper">
                            <img id="biasAdjustmentImage" src="" alt="Base Image" class="bias-adjustment-image">
                        </div>
                        <img id="clientPreviewImage" src="" alt="Client Preview" class="client-preview-image" style="display: none;">
                    </div>
                </div>
            </div>
            <div class="image-bias-adjustment-actions">
                <button type="button" id="cancelBiasAdjustmentBtn" class="btn-secondary">Cancel</button>
                <button type="button" id="saveBiasAdjustmentBtn" class="btn-primary">Save Adjustment</button>
            </div>
        </div>
    </div>

    <!-- Image Bias Adjustment Confirmation Dialog -->
    <div id="biasAdjustmentConfirmDialog" class="modal alert-theme">
        <div class="modal-content bias-confirm-content center">
            <div class="bias-confirm-header">
                <h3>Confirm Bias Adjustment</h3>
                <button id="closeBiasConfirmBtn" class="close-dialog">&times;</button>
            </div>
            <div class="bias-confirm-body">
                <p>Review the previews below to confirm your bias adjustment:</p>
                <div class="bias-confirm-previews">
                    <div class="preview-section">
                        <h4>Client Preview</h4>
                        <div class="preview-image-container">
                            <img id="confirmClientPreview" src="" alt="Client Preview">
                        </div>
                    </div>
                    <div class="preview-section">
                        <h4>Server Preview</h4>
                        <div class="preview-image-container">
                            <img id="confirmServerPreview" src="" alt="Server Preview">
                        </div>
                    </div>
                </div>
            </div>
            <div class="bias-confirm-actions">
                <button type="button" id="cancelBiasConfirmBtn" class="btn-secondary">Cancel</button>
                <button type="button" id="acceptBiasConfirmBtn" class="btn-primary">Accept & Save</button>
            </div>
        </div>
    </div>

    <!-- Character Data Confirmation Modal -->
    <div id="characterDataConfirmModal" class="modal alert-theme">
        <div class="modal-content center">
            <div class="modal-header">
                <h3>Character Data Detected</h3>
                <button id="closeCharacterDataConfirmBtn" class="close-dialog">&times;</button>
            </div>
            <div class="modal-body">
                <p>You have character prompt data that won't be processed by V3 models.</p>
                <div class="modal-actions form-actions">
                    <button type="button" id="cancelGenerationBtn" class="btn-danger">
                        <i class="fas fa-times"></i> Cancel
                    </button>
                    <button type="button" id="removeCharacterDataBtn" class="btn-primary">
                        <i class="fas fa-trash"></i> Remove Data
                    </button>
                    <button type="button" id="includeCharacterDataBtn" class="btn-secondary">
                        <i class="fas fa-save"></i> Keep Data
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Base Image Change Alert Modal -->
    <div id="baseImageChangeAlertModal" class="modal alert-theme">
        <div class="modal-content center">
            <div class="modal-header">
                <h3>Replace Reference</h3>
                <button id="closeBaseImageChangeAlertBtn" class="close-dialog">&times;</button>
            </div>
            <div class="modal-body">
                <p>Are you sure you want to replace the reference image?</p>
                <p><b>The inpainting mask will be erased.</b></p>
                <div class="modal-actions form-actions">
                    <button type="button" id="cancelBaseImageChangeBtn" class="btn-secondary">
                        <i class="fas fa-times"></i> Cancel
                    </button>
                    <button type="button" id="confirmBaseImageChangeBtn" class="btn-primary">
                        <i class="fas fa-check"></i> Replace
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Image Bias Mask Alert Modal -->
    <div id="imageBiasMaskAlertModal" class="modal alert-theme">
        <div class="modal-content center">
            <div class="modal-header">
                <h3>Mask Detected</h3>
                <button id="closeImageBiasMaskAlertBtn" class="close-dialog">&times;</button>
            </div>
            <div class="modal-body">
                <p>Changing the image bias will invalidate the mask.</p>
                <div class="modal-actions form-actions">
                    <button type="button" id="cancelImageBiasBtn" class="btn-secondary">
                        <i class="fas fa-times"></i> Cancel
                    </button>
                    <button type="button" id="removeMaskBtn" class="btn-secondary">
                        <i class="fas fa-trash"></i> Remove Mask
                    </button>
                    <button type="button" id="createMaskBtn" class="btn-primary">
                        <i class="fas fa-magic"></i> New Mask
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Lightbox Modal -->
    <div id="lightboxModal" class="lightbox-modal">
        <!-- Top left toggle button for base image -->
        <button id="toggleBaseImageBtn" class="lightbox-toggle-btn" style="display:none;">
            <i class="fas fa-exchange-alt"></i> <span>Show Base</span>
        </button>
        
        <!-- Close button overlay -->
        <button id="lightboxCloseBtn" class="lightbox-close-btn">
            <i class="nai-thin-cross"></i>
        </button>
        
        <div class="lightbox-container">
            <!-- Main content area with image and prompt panel side by side -->
            <div class="lightbox-main-content">
                <!-- Image and Controls Section -->
                <div class="lightbox-image-section">
                    <div class="lightbox-image-container">
                        <img id="lightboxImage" src="" alt="Generated Image">
                    </div>
                    
                    <!-- Controls Section -->
                    <div class="lightbox-controls-section">
                        <div class="lightbox-controls">
                            <button id="lightboxDownloadBtn" class="btn-secondary round-button">
                                <i class="nai-save"></i>
                            </button>
                            <button id="lightboxUpscaleBtn" class="btn-secondary round-button" style="display:none;">
                                <i class="nai-upscale"></i>
                            </button>
                            <button id="lightboxRerollBtn" class="btn-secondary round-button" style="display:none;">
                                <i class="nai-dice"></i>
                            </button>
                            <button id="lightboxRerollEditBtn" class="btn-secondary round-button" style="display:none;">
                                <i class="nai-settings"></i>
                            </button>
                            <button id="lightboxScrapBtn" class="btn-secondary round-button" style="display:none;">
                                <i class="nai-image-tool-sketch"></i>
                            </button>
                            <button id="lightboxPinBtn" class="btn-secondary round-button" style="display:none;">
                                <i class="nai-heart-disabled"></i>
                            </button>
                            <button id="metadataBtn" class="btn-secondary metadata-btn-mobile round-button">
                                <i class="fas fa-info-circle"></i>
                            </button>
                            <button id="lightboxDeleteBtn" class="btn-danger round-button" style="display:none;">
                                <i class="nai-trash"></i>
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Prompt Panel (Right Side) -->
                <div id="promptPanel" class="prompt-panel hidden">
                    <div class="prompt-panel-content">
                        <div id="allPromptsContent" class="character-prompts-list">
                            <!-- All prompts will be populated here -->
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Metadata Section -->
            <div class="lightbox-metadata-section">
                <div class="metadata-table-container">
                    <div class="metadata-grid">
                        <!-- Row 1: Type, Name, Model, Resolution -->
                        <div class="metadata-row">
                            <div class="metadata-cell metadata-small">
                                <span class="metadata-label">Type</span>
                                <span id="metadataType" class="metadata-value">-</span>
                            </div>
                            <div class="metadata-cell metadata-small">
                                <span class="metadata-label">Name</span>
                                <span id="metadataName" class="metadata-value">-</span>
                            </div>
                            <div class="metadata-cell">
                                <span class="metadata-label">Model</span>
                                <div class="metadata-model-content">
                                    <span id="metadataModel" class="metadata-value">-</span>
                                    <div class="metadata-buttons">
                                        <button id="promptBtn" class="metadata-btn">Prompts</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Row 2: Steps, Guidance, Seed 1, Seed 2, Sampler, Rescale, Noise Schedule -->
                        <div class="metadata-row">
                            <div class="metadata-cell metadata-small">
                                <span class="metadata-label">Resolution</span>
                                <span id="metadataResolution" class="metadata-value">-</span>
                            </div>
                            
                            <div class="metadata-cell metadata-small">
                                <span class="metadata-label">Seed 1</span>
                                <span id="metadataSeed1" class="metadata-value">-</span>
                            </div>
                            <div class="metadata-cell metadata-small">
                                <span class="metadata-label">Seed 2</span>
                                <span id="metadataSeed2" class="metadata-value">-</span>
                            </div>
                            <div class="metadata-cell metadata-very-small">
                                <span class="metadata-label">Steps</span>
                                <span id="metadataSteps" class="metadata-value">-</span>
                            </div>
                            <div class="metadata-cell metadata-very-small">
                                <span class="metadata-label">Guidance</span>
                                <span id="metadataGuidance" class="metadata-value">-</span>
                            </div>
                            <div class="metadata-cell">
                                <span class="metadata-label">Rescale</span>
                                <span id="metadataRescale" class="metadata-value">-</span>
                            </div>
                            <div class="metadata-cell">
                                <span class="metadata-label">Sampler</span>
                                <span id="metadataSampler" class="metadata-value">-</span>
                            </div>
                            <div class="metadata-cell">
                                <span class="metadata-label">Noise Schedule</span>
                                <span id="metadataNoiseSchedule" class="metadata-value">-</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Expandable prompt/UC sections -->
                    <div id="promptExpanded" class="metadata-expanded" style="display: none;">
                        <div class="metadata-expanded-header">
                            <span>Prompt</span>
                            <button class="close-expanded">&times;</button>
                        </div>
                        <div id="promptContent" class="metadata-expanded-content"></div>
                    </div>
                    
                    <div id="ucExpanded" class="metadata-expanded" style="display: none;">
                        <div class="metadata-expanded-header">
                            <span>Undesired Content</span>
                            <button class="close-expanded">&times;</button>
                        </div>
                        <div id="ucContent" class="metadata-expanded-content"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Metadata Dialog (Mobile Only) -->
    <div id="metadataDialog" class="metadata-dialog">
        <div class="metadata-dialog-content">
            <div class="metadata-dialog-header">
                <h3>Image Metadata</h3>
                <button id="closeMetadataDialog" class="close-dialog">&times;</button>
            </div>
            <div class="metadata-dialog-body">
                <div class="metadata-table-container">
                    <div class="metadata-grid">
                        <!-- Row 1: Type, Name, Model, Resolution -->
                        <div class="metadata-row">
                            <div class="metadata-cell">
                                <span class="metadata-label">Type</span>
                                <span id="dialogMetadataType" class="metadata-value">-</span>
                            </div>
                            <div class="metadata-cell">
                                <span class="metadata-label">Name</span>
                                <span id="dialogMetadataName" class="metadata-value">-</span>
                            </div>
                            <div class="metadata-cell metadata-model-cell">
                                <span class="metadata-label">Model</span>
                                <div class="metadata-model-content">
                                    <span id="dialogMetadataModel" class="metadata-value">-</span>
                                    <div class="metadata-buttons">
                                        <button id="dialogPromptBtn" class="metadata-btn">Prompts</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Row 2: Steps, Guidance, Seed 1, Seed 2, Sampler, Rescale, Noise Schedule -->
                        <div class="metadata-row">
                            <div class="metadata-cell">
                                <span class="metadata-label">Resolution</span>
                                <span id="dialogMetadataResolution" class="metadata-value">-</span>
                            </div>
                            <div class="metadata-cell">
                                <span class="metadata-label">Seed 1</span>
                                <span id="dialogMetadataSeed1" class="metadata-value">-</span>
                            </div>
                            <div class="metadata-cell">
                                <span class="metadata-label">Seed 2</span>
                                <span id="dialogMetadataSeed2" class="metadata-value">-</span>
                            </div>
                            <div class="metadata-cell">
                                <span class="metadata-label">Steps</span>
                                <span id="dialogMetadataSteps" class="metadata-value">-</span>
                            </div>
                            <div class="metadata-cell">
                                <span class="metadata-label">Guidance</span>
                                <span id="dialogMetadataGuidance" class="metadata-value">-</span>
                            </div>
                            <div class="metadata-cell">
                                <span class="metadata-label">Rescale</span>
                                <span id="dialogMetadataRescale" class="metadata-value">-</span>
                            </div>
                            <div class="metadata-cell">
                                <span class="metadata-label">Sampler</span>
                                <span id="dialogMetadataSampler" class="metadata-value">-</span>
                            </div>
                            <div class="metadata-cell">
                                <span class="metadata-label">Noise Schedule</span>
                                <span id="dialogMetadataNoiseSchedule" class="metadata-value">-</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Expandable prompt/UC sections -->
                    <div id="dialogPromptExpanded" class="metadata-expanded" style="display: none;">
                        <div class="metadata-expanded-header">
                            <span>Prompt</span>
                            <button class="close-expanded">&times;</button>
                        </div>
                        <div id="dialogPromptContent" class="metadata-expanded-content"></div>
                    </div>
                    
                    <div id="dialogUcExpanded" class="metadata-expanded" style="display: none;">
                        <div class="metadata-expanded-header">
                            <span>Undesired Content</span>
                            <button class="close-expanded">&times;</button>
                        </div>
                        <div id="dialogUcContent" class="metadata-expanded-content"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Workspace Management Modal -->
    <div id="workspaceManageModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Workspaces</h3>
                <button id="closeWorkspaceManageBtn" class="close-dialog" aria-label="Close">&times;</button>
            </div>
            <div class="modal-body">
                <div class="workspace-management-section">
                    <div id="workspaceManageList" class="workspace-manage-list">
                        <!-- Workspace management items will be populated here -->
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" id="workspaceAddBtn" class="btn-secondary" title="Add Workspace">
                    <span>New Workspace</span>
                    <i class="fas fa-grid-2-plus"></i>
                </button>
            </div>
        </div>
    </div>

    <!-- Add/Rename Workspace Modal -->
    <div id="workspaceEditModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="workspaceEditTitle">Add Workspace</h3>
            </div>
            <div class="modal-body">
                <div class="form-section">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="workspaceNameInput">Workspace Name</label>
                            <input type="text" id="workspaceNameInput" class="form-control hover-show colored" placeholder="Enter workspace name..." maxlength="50"  autocorrect="false"  autocapitalize="false">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="workspaceColorInput">Color</label>
                            <input type="color" id="workspaceColorInput" class="form-control" value="#124">
                        </div>
                        <div class="form-group">
                            <label for="workspaceBackgroundColorInput">Background</label>
                            <input type="color" id="workspaceBackgroundColorInput" class="form-control" value="#0a1a2a">
                        </div>
                        <div class="form-group">
                            <label for="workspaceBackgroundOpacityInput">Opacity</label>
                            <input type="number" id="workspaceBackgroundOpacityInput" class="form-control hover-show colored" min="0" max="1" step="0.01" value="0.3" style="width: 80px;" title="Scroll or type to adjust opacity">
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="workspaceBackgroundImageInput">Background Image</label>
                        <div class="background-image-selector">
                            <input type="text" id="workspaceBackgroundImageInput" class="form-control hover-show colored" readonly placeholder="No background image selected">
                            <button type="button" id="selectBackgroundImageBtn" class="btn-secondary">
                                <i class="fas fa-images"></i> Select Image
                            </button>
                        </div>
                        <small class="form-text">Optional: Image from this workspace to use as background</small>
                    </div>
                </div>
                <div class="modal-actions btn-group">
                    <button type="button" id="workspaceSaveBtn" class="btn-primary">
                        <i class="fas fa-save"></i> Save
                    </button>
                    <button type="button" id="workspaceCancelBtn" class="btn-secondary">
                        Cancel
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Workspace Dump Modal -->
    <div id="workspaceDumpModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Dump Workspace</h3>
            </div>
            <div class="modal-body">
                <p>Select the target workspace to merge all items from <strong id="dumpSourceWorkspaceName"></strong>:</p>
                <div class="form-group">
                    <label for="dumpTargetSelect">Target Workspace</label>
                    <select id="dumpTargetSelect" class="form-control hover-show">
                        <!-- Options will be populated here -->
                    </select>
                </div>
                <div class="modal-actions btn-group">
                    <button type="button" id="workspaceDumpConfirmBtn" class="btn-primary">
                        <i class="fas fa-arrow-right"></i> Dump
                    </button>
                    <button type="button" id="workspaceDumpCancelBtn" class="btn-secondary">
                        Cancel
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Reference Manager Modal -->
    <div id="cacheManagerModal" class="modal">
        <div class="modal-content cache-manager-content">
            <div class="modal-header">
                <h3>Reference Manager</h3>
                <button id="closeCacheManagerBtn" class="close-dialog" aria-label="Close">&times;</button>
            </div>
            <div class="modal-body">
                <div class="cache-manager-controls">
                    <div class="cache-manager-header">
                        <div class="cache-manager-workspace-selector">
                            <label for="cacheManagerWorkspaceDropdown">Workspace:</label>
                            <div id="cacheManagerWorkspaceDropdown" class="custom-dropdown">
                                <button type="button" id="cacheManagerWorkspaceDropdownBtn" class="btn-secondary">
                                    <i class="fas fa-folder-open"></i>
                                    <span id="cacheManagerWorkspaceSelected">Default</span>
                                </button>
                                <div id="cacheManagerWorkspaceDropdownMenu" class="custom-dropdown-menu" style="display: none;">
                                    <!-- Workspace options will be populated here -->
                                </div>
                            </div>
                        </div>
                        <div class="cache-manager-actions">
                            <div id="cacheManagerUploadDropdown" class="custom-dropdown">
                                <button type="button" id="cacheManagerUploadDropdownBtn" class="btn-primary">
                                    <i class="nai-import"></i> Upload
                                </button>
                                <div id="cacheManagerUploadDropdownMenu" class="custom-dropdown-menu" style="display: none;">
                                    <div class="custom-dropdown-option" data-upload-type="reference">
                                        <i class="fas fa-images"></i> Reference
                                    </div>
                                    <div class="custom-dropdown-option" data-upload-type="vibe">
                                        <i class="nai-vibe-transfer"></i> Vibe
                                    </div>
                                </div>
                            </div>
                            <button type="button" id="cacheManagerMoveBtn" class="btn-secondary" style="display: none;">
                                <i class="fas fa-arrow-right"></i> Move
                            </button>
                            <button type="button" id="vibeManagerMoveBtn" class="btn-secondary" style="display: none;">
                                <i class="fas fa-arrow-right"></i> Move Vibes
                            </button>
                            <button type="button" id="cacheManagerRefreshBtn" class="btn-secondary">
                                <i class="nai-reload"></i> Refresh
                            </button>

                        </div>
                    </div>
                </div>
                
                <!-- Tab Navigation -->
                <div class="cache-manager-tabs">
                    <div class="gallery-toggle-group" data-active="references">
                        <button type="button" class="gallery-toggle-btn active" data-tab="references" data-title="Base Images">
                            <i class="fas fa-images"></i>
                        </button>
                        <button type="button" class="gallery-toggle-btn" data-tab="vibe" data-title="Vibe Encodings">
                            <i class="nai-vibe-transfer"></i>
                        </button>
                        <div class="gallery-toggle-slider"></div>
                    </div>
                    <span id="cacheManagerTabTitle" class="tab-text">Base Images</span>
                </div>
                
                <div class="cache-manager-body">
                    <!-- References Tab -->
                    <div class="tab-pane active" id="references-tab">
                        <div class="cache-manager-gallery-container">
                            <div id="cacheManagerGallery" class="cache-manager-gallery">
                                <!-- Reference images will be loaded here -->
                            </div>
                            <div class="cache-manager-loading" id="cacheManagerLoading" style="display: none;">
                                <div class="spinner"></div>
                                <p>Loading cache images...</p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Vibe Images Tab -->
                    <div class="tab-pane" id="vibe-tab">
                        <div class="vibe-manager-gallery-container">
                            <div id="vibeManagerGallery" class="vibe-manager-gallery">
                                <!-- Vibe images will be loaded here -->
                            </div>
                            <div class="vibe-manager-loading" id="vibeManagerLoading" style="display: none;">
                                <div class="spinner"></div>
                                <p>Loading vibe images...</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Reference Manager Upload Modal -->
    <div id="cacheManagerUploadModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Upload Images to Reference</h3>
                <button id="closeCacheManagerUploadBtn" class="close-dialog" aria-label="Close">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-section">
                    <div class="form-group">
                        <label for="cacheManagerFileInput">Select Images</label>
                        <input type="file" id="cacheManagerFileInput" class="form-control" accept="image/*" multiple>
                        <small class="form-text">Select one or more images to upload to the cache</small>
                    </div>
                    <div class="form-group">
                        <label for="cacheManagerUploadProgress">Upload Progress</label>
                        <div id="cacheManagerUploadProgress" class="upload-progress" style="display: none;">
                            <div class="progress-bar">
                                <div class="progress-fill" id="cacheManagerProgressFill"></div>
                            </div>
                            <span id="cacheManagerProgressText">0%</span>
                        </div>
                    </div>
                </div>
                <div class="modal-actions btn-group">
                    <button type="button" id="cacheManagerUploadConfirmBtn" class="btn-primary" disabled>
                        <i class="nai-import"></i> Upload
                    </button>
                    <button type="button" id="cacheManagerUploadCancelBtn" class="btn-secondary">
                        Cancel
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Reference Manager Move Modal -->
    <div id="cacheManagerMoveModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Move Reference Images</h3>
                <button id="closeCacheManagerMoveBtn" class="close-dialog" aria-label="Close">&times;</button>
            </div>
            <div class="modal-body">
                <p>Select the target workspace to move <strong id="cacheManagerMoveCount">0</strong> selected images:</p>
                <div class="form-group">
                    <label for="cacheManagerMoveTargetSelect">Target Workspace</label>
                    <select id="cacheManagerMoveTargetSelect" class="form-control hover-show">
                        <!-- Options will be populated here -->
                    </select>
                </div>
                <div class="modal-actions btn-group">
                    <button type="button" id="cacheManagerMoveConfirmBtn" class="btn-primary">
                        <i class="fas fa-arrow-right"></i> Move
                    </button>
                    <button type="button" id="cacheManagerMoveCancelBtn" class="btn-secondary">
                        Cancel
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Vibe Manager Upload Modal -->
    <div id="vibeManagerUploadModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Upload & Encode Vibe Image</h3>
                <button id="closeVibeManagerUploadBtn" class="close-dialog" aria-label="Close">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-section">
                    <div class="form-group">
                        <label for="vibeManagerFileInput">Select Image</label>
                        <input type="file" id="vibeManagerFileInput" class="form-control" accept="image/*">
                        <small class="form-text">Select an image to encode for vibe transfer</small>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="vibeManagerModelSelect">Model</label>
                            <div id="vibeManagerModelDropdown" class="custom-dropdown">
                                <button type="button" id="vibeManagerModelDropdownBtn" class="btn-secondary">
                                    <i class="fas fa-cog"></i>
                                    <span id="vibeManagerModelSelected">V4.5</span>
                                </button>
                                <div id="vibeManagerModelDropdownMenu" class="custom-dropdown-menu" style="display: none;">
                                    <!-- V4+ models will be populated here -->
                                </div>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="vibeManagerIeInput">Information Extraction</label>
                            <input type="number" id="vibeManagerIeInput" class="form-control hover-show" min="0" max="1" step="0.01" value="0.35">
                        </div>
                    </div>
                    <small class="form-text">Information Extraction: Controls how much information is extracted from the image (0 = minimal, 1 = maximum).</small>
                </div>
                <div class="modal-actions btn-group">
                    <button type="button" id="vibeManagerUploadConfirmBtn" class="btn-primary" disabled>
                        <i class="nai-import"></i> Upload & Encode
                    </button>
                    <button type="button" id="vibeManagerUploadCancelBtn" class="btn-secondary">
                        Cancel
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Vibe Manager IE Request Modal -->
    <div id="vibeManagerIeModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Request New Information Extraction</h3>
                <button id="closeVibeManagerIeBtn" class="close-dialog" aria-label="Close">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-section">
                    <div class="form-row">
                    <div class="form-group">
                        <label for="vibeManagerIeModelSelect">Model</label>
                        <div id="vibeManagerIeModelDropdown" class="custom-dropdown">
                            <button type="button" id="vibeManagerIeModelDropdownBtn" class="btn-secondary">
                                <i class="fas fa-cog"></i>
                                <span id="vibeManagerIeModelSelected">V4.5</span>
                            </button>
                            <div id="vibeManagerIeModelDropdownMenu" class="custom-dropdown-menu" style="display: none;">
                                <!-- V4+ models will be populated here -->
                            </div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="vibeManagerIeInput2">Information Extraction</label>
                        <input type="number" id="vibeManagerIeInput2" class="form-control hover-show" min="0" max="1" step="0.01" value="0.35">
                    </div>
                    </div>
                    <small class="form-text">Information Extraction: Controls how much information is extracted from the image (0 = minimal, 1 = maximum). Use scroll wheel to adjust.</small>

                </div>
                <div class="modal-actions btn-group">
                    <button type="button" id="vibeManagerIeConfirmBtn" class="btn-primary">
                        <i class="nai-vibe-transfer"></i> Request Encoding
                    </button>
                    <button type="button" id="vibeManagerIeCancelBtn" class="btn-secondary">
                        Cancel
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Vibe Manager From Reference Modal -->
    <div id="vibeManagerFromReferenceModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Create Vibe Encoding from Reference</h3>
                <button id="closeVibeManagerFromReferenceBtn" class="close-dialog" aria-label="Close">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-section">
                    <div class="form-group">
                        <label>Reference Image</label>
                        <div id="vibeManagerFromReferencePreview" class="vibe-manager-reference-preview">
                            <!-- Reference image preview will be shown here -->
                        </div>
                    </div>
                    <div class="form-row">
                    <div class="form-group">
                        <label for="vibeManagerFromReferenceModelSelect">Model</label>
                        <div id="vibeManagerFromReferenceModelDropdown" class="custom-dropdown">
                            <button type="button" id="vibeManagerFromReferenceModelDropdownBtn" class="btn-secondary">
                                <i class="fas fa-cog"></i>
                                <span id="vibeManagerFromReferenceModelSelected">V4.5</span>
                            </button>
                            <div id="vibeManagerFromReferenceModelDropdownMenu" class="custom-dropdown-menu" style="display: none;">
                                <!-- V4+ models will be populated here -->
                            </div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="vibeManagerFromReferenceIeInput">Information Extraction</label>
                        <input type="number" id="vibeManagerFromReferenceIeInput" class="form-control hover-show" min="0" max="1" step="0.01" value="0.35">
                    </div>
                    </div>
                    <small class="form-text">Information Extraction: Controls how much information is extracted from the image (0 = minimal, 1 = maximum). Use scroll wheel to adjust.</small>

                </div>
                <div class="modal-actions btn-group">
                    <button type="button" id="vibeManagerFromReferenceConfirmBtn" class="btn-primary">
                        <i class="nai-vibe-transfer"></i> Create Vibe Encoding
                    </button>
                    <button type="button" id="vibeManagerFromReferenceCancelBtn" class="btn-secondary">
                        Cancel
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Vibe Manager Delete Modal -->
    <div id="vibeManagerDeleteModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Delete Vibe Items</h3>
                <button id="closeVibeManagerDeleteBtn" class="close-dialog" aria-label="Close">&times;</button>
            </div>
            <div class="modal-body">
                <p>Select items to delete:</p>
                <div class="form-section">
                    <div id="vibeManagerDeleteItemsList" class="vibe-delete-items-list">
                        <!-- Items will be listed here -->
                    </div>
                </div>
                <div class="modal-actions btn-group">
                    <button type="button" id="vibeManagerDeleteConfirmBtn" class="btn-danger">
                        <i class="nai-trash"></i> Delete Selected
                    </button>
                    <button type="button" id="vibeManagerDeleteCancelBtn" class="btn-secondary">
                        Cancel
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Vibe Manager Move Modal -->
    <div id="vibeManagerMoveModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Move Vibe Encodings</h3>
                <button id="closeVibeManagerMoveBtn" class="close-dialog" aria-label="Close">&times;</button>
            </div>
            <div class="modal-body">
                <p>Select the target workspace to move <strong id="vibeManagerMoveCount">0</strong> selected vibe encodings:</p>
                <div class="form-group">
                    <label for="vibeManagerMoveTargetSelect">Target Workspace</label>
                    <select id="vibeManagerMoveTargetSelect" class="form-control hover-show">
                        <!-- Options will be populated here -->
                    </select>
                </div>
                <div class="modal-actions btn-group">
                    <button type="button" id="vibeManagerMoveConfirmBtn" class="btn-primary">
                        <i class="fas fa-arrow-right"></i> Move
                    </button>
                    <button type="button" id="vibeManagerMoveCancelBtn" class="btn-secondary">
                        Cancel
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Background Image Selection Modal -->
    <div id="backgroundImageModal" class="modal">
        <div class="modal-content background-image-modal-content">
            <div class="modal-header">
                <h3>Select Background Image</h3>
                <button id="closeBackgroundImageModalBtn" class="close-dialog">&times;</button>
            </div>
            <div class="modal-body">
                <div class="background-image-search">
                    <input type="text" id="backgroundImageSearchInput" class="form-control" placeholder="Search images..."  autocorrect="false"  autocapitalize="false" >
                </div>
                <div class="background-image-options">
                    <button type="button" id="noBackgroundImageBtn" class="background-image-option no-image-option">
                        <div class="background-image-thumbnail no-image">
                            <i class="fas fa-times"></i>
                        </div>
                        <span class="background-image-name">No background image</span>
                    </button>
                </div>
                <div id="backgroundImageGrid" class="background-image-grid">
                    <!-- Thumbnails will be loaded here -->
                </div>
                <div id="backgroundImageLoading" class="background-image-loading" style="display: none;">
                    <div class="spinner"></div>
                    <p>Loading images...</p>
                </div>
                <div class="modal-actions">
                    <button type="button" id="backgroundImageCancelBtn" class="btn-secondary">
                        Cancel
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Bulk Change Preset Modal -->
    <div id="bulkChangePresetModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Change Preset Name</h3>
                <button id="closeBulkChangePresetBtn" class="close-dialog">&times;</button>
            </div>
            <div class="modal-body">
                <p>Change preset name for <span id="bulkChangePresetSelectedCount">0</span> selected image(s):</p>
                <div class="form-group">
                    <label for="bulkChangePresetNameInput">New Preset Name</label>
                    <input type="text" id="bulkChangePresetNameInput" class="form-control" placeholder="Enter new preset name..." maxlength="100"  autocorrect="false"  autocapitalize="false">
                    <small class="form-text">Leave empty to remove preset name</small>
                </div>
                <div class="modal-actions btn-group">
                    <button type="button" id="bulkChangePresetConfirmBtn" class="btn-primary">
                        <i class="fas fa-save"></i> Update Preset Names
                    </button>
                    <button type="button" id="bulkChangePresetCancelBtn" class="btn-secondary">
                        Cancel
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- PIN Re-authentication Modal -->
    <div id="pinModal" class="alert-theme modal" style="display: none;">
        <div class="modal-content center" style="width: auto;">
            <div class="modal-header">
                <h2>Authentication</h2>
                <button id="closePinModalBtn" class="close-dialog" aria-label="Close">&times;</button>
            </div>
            <div class="modal-body">
                <p>Enter your PIN to continue.</p>
                <div class="pin-display">
                    <div class="pin-dots">
                        <div class="pin-dot" data-index="0"></div>
                        <div class="pin-dot" data-index="1"></div>
                        <div class="pin-dot" data-index="2"></div>
                        <div class="pin-dot" data-index="3"></div>
                        <div class="pin-dot" data-index="4"></div>
                        <div class="pin-dot" data-index="5"></div>
                    </div>
                </div>
                <div class="pin-pad">
                    <div class="pin-row">
                        <button class="pin-button" data-number="1"><i class="fas fa-1"></i></button>
                        <button class="pin-button" data-number="2"><i class="fas fa-2"></i></button>
                        <button class="pin-button" data-number="3"><i class="fas fa-3"></i></button>
                    </div>
                    <div class="pin-row">
                        <button class="pin-button" data-number="4"><i class="fas fa-4"></i></button>
                        <button class="pin-button" data-number="5"><i class="fas fa-5"></i></button>
                        <button class="pin-button" data-number="6"><i class="fas fa-6"></i></button>
                    </div>
                    <div class="pin-row">
                        <button class="pin-button" data-number="7"><i class="fas fa-7"></i></button>
                        <button class="pin-button" data-number="8"><i class="fas fa-8"></i></button>
                        <button class="pin-button" data-number="9"><i class="fas fa-9"></i></button>
                    </div>
                    <div class="pin-row">
                        <button class="pin-button clear-btn" data-action="clear">
                          <i class="fas fa-c"></i>
                        </button>
                        <button class="pin-button" data-number="0"><i class="fas fa-0"></i></button>
                        <button class="pin-button backspace-btn" data-action="backspace">
                            <i class="fas fa-delete-left"></i>
                        </button>
                    </div>
                </div>
                <div id="pinModalError" class="form-text" style="color: var(--danger-color); display: none;"></div>
                <div class="modal-actions btn-group" style="margin-top:1em;">
                    <button type="button" id="pinModalCancelBtn" class="btn-secondary">Cancel</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Hidden file input for image upload -->
    <input type="file" id="imageUploadInput" accept="image/*" multiple style="display: none;">

    <!-- Confetti Container -->
    <div id="confettiContainer"></div>

    <!-- Toast Container -->
    <div id="toastContainer" class="toast-container"></div>

    <script src="scripts/comp/dropdown.js"></script>
    <script src="scripts/comp/lightbox.js"></script>
    <script src="scripts/comp/modalUtils.js"></script>
    <script src="scripts/comp/inpaint.js"></script>
    <script src="scripts/comp/workspaceUtils.js"></script>
    <script src="scripts/comp/autocompleteUtils.js"></script>
    <script src="scripts/comp/imageBias.js"></script>
    <script src="scripts/comp/referenceManager.js"></script>
    <script src="scripts/comp/emphasisManager.js"></script>
    <script src="scripts/comp/confirmationDialog.js"></script>
    <script src="scripts/comp/creditCostDialog.js"></script>
    <script src="scripts/comp/galleryToolbar.js"></script>
    <script src="scripts/comp/customScrollbar.js"></script>
    <script src="scripts/comp/pinModal.js"></script>
    <script src="scripts/comp/keyboardShortcuts.js"></script>
    <script src="scripts/comp/datasetTagToolbar.js"></script>
    <script src="scripts/comp/galleryView.js"></script>
    <script src="scripts/websocket.js"></script>
    <script src="scripts/app.js"></script>
</body>
</html> 