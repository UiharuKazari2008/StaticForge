<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>StaticForge - AI Image Generator</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;500;700&family=Oxanium:wght@300;400;500;600;700&family=Share+Tech+Mono&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script src="/tagSets.js"></script>
</head>
<body>
<!-- Background layers for smooth transitions -->
<div class="bokeh-background current-bg"></div>
<div class="bokeh-background next-bg" style="opacity: 0;"></div>

<svg class="bokeh" viewBox="0 0 10 10" xmlns="http://www.w3.org/2000/svg">
  <circle cx="10%" cy="85%" r="60%"  />
  <circle cx="45%" cy="50%" r="12%"  />
  <circle cx="85%" cy="35%" r="25%"  />
  <circle cx="60%" cy="85%" r="16%"  />
  <circle cx="45%" cy="50%" r="24%"  />
  <circle cx="35%" cy="25%" r="16%"  />
  <circle cx="90%" cy="-25%" r="28%" />
  <circle cx="-15%" cy="30%" r="24%" />
  <circle cx="65%" cy="85%" r="44%"  />
  <circle cx="45%" cy="50%" r="16%"  />
  <circle cx="25%" cy="75%" r="20%"  />
  <circle cx="75%" cy="15%" r="18%"  />
  <circle cx="15%" cy="15%" r="22%"  />
  <circle cx="80%" cy="70%" r="14%"  />
  <circle cx="5%" cy="45%" r="26%"  />
</svg>
    <!-- Manual Generation Modal -->
    <div id="manualModal" class="modal">
        <div class="modal-content manual-modal-content">
            <div class="manual-modal-split">
                <div class="manual-modal-form-section">
                    <form id="manualForm">
                        <div class="form-section form-section-scroll">
                            <div class="form-group">
                                <div class="prompt-tabs">
                                    <div class="tab-header">
                                        <div id="tab-buttons" class="tab-buttons">
                                            <button type="button" class="tab-btn active" data-tab="prompt">
                                                <i class="nai-penwriting"></i> Prompt
                                            </button>
                                            <button type="button" class="tab-btn" data-tab="uc">
                                                <i class="nai-minus"></i> UC
                                            </button>
                                            <button type="button" class="tab-btn" data-tab="settings">
                                                <i class="nai-settings"></i>
                                            </button>
                                        </div>
                                        <div class="extra-buttons">
                                            <!-- Dataset Dropdown -->
                                            <div id="datasetDropdown" class="custom-dropdown dropdown">
                                                <button type="button" id="datasetDropdownBtn" class="btn-secondary toggle-btn" data-state="off" title="Dataset Selection">
                                                    <i id="datasetIcon" class="nai-sakura"></i>
                                                    <span id="datasetSelected" class="badge hidden"></span>
                                                </button>
                                                <div id="datasetDropdownMenu" class="custom-dropdown-menu" style="display: none;"></div>
                                            </div>
                                            
                                            <!-- Quality Toggle -->
                                            <button type="button" id="qualityToggleBtn" class="btn-secondary toggle-btn" data-state="off" title="Enable Quality Enhancements">
                                                <i class="fa-chess-king fas"></i>
                                            </button>
                                            
                                            <!-- UC Presets Dropdown -->
                                            <div id="ucPresetsDropdown" class="custom-dropdown dropdown">
                                                <button type="button" id="ucPresetsDropdownBtn" class="btn-secondary toggle-btn" data-state="off" title="UC Presets">
                                                    <div class="uc-boxes">
                                                        <div class="uc-box" data-level="1"></div>
                                                        <div class="uc-box" data-level="2"></div>
                                                        <div class="uc-box" data-level="3"></div>
                                                    </div>
                                                </button>
                                                <div id="ucPresetsDropdownMenu" class="custom-dropdown-menu" style="display: none;"></div>
                                            </div>

                                            <button type="button" class="show-both-btn" id="showBothBtn" title="Show both panes">
                                                <i class="nai-detatch-up"></i>
                                            </button>
                                        </div>
                                    </div>
                                    <div class="tab-content">
                                        <div class="tab-pane active" id="prompt-tab" data-label="Base Prompt">
                                            <textarea id="manualPrompt" class="form-control prompt-textarea textarea-inset" placeholder="Enter your prompt..." required></textarea>
                                        </div>
                                        <div class="tab-pane" id="uc-tab" data-label="Undesired Content">
                                            <textarea id="manualUc" class="form-control textarea-inset" rows="3" placeholder="Enter undesired content..."></textarea>
                                        </div>
                                        <div class="tab-pane" id="settings-tab" data-label="Dataset Settings">
                                            <div class="dataset-bias-container">
                                                <!-- Dataset bias inputs will be dynamically populated here -->
                                                <div id="datasetBiasControls">
                                                    <!-- Dynamic content -->
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Character Prompts Section -->
                            <div class="form-group" style="margin-top: -10px;">
                                <div class="character-prompts-header">
                                    <div class="character-prompts-title-group">
                                        <button type="button" id="randomPromptToggleBtn" class="btn-secondary toggle-btn" data-state="off" title="Random Prompt">
                                            <i class="nai-dice"></i>
                                        </button>
                                        <button type="button" id="randomPromptRefreshBtn" class="btn-secondary" title="Generate new random prompt" style="display: none;">
                                            <i class="nai-reload"></i>
                                        </button>
                                        <button type="button" id="randomPromptNsfwBtn" class="btn-secondary toggle-btn" data-state="off" title="Toggle NSFW content" style="display: none;">
                                            NSFW
                                        </button>
                                        <button type="button" id="randomPromptTransferBtn" class="btn-secondary" title="Transfer random prompt to main prompt and exit random mode" style="display: none;">
                                            <i class="nai-export"></i>
                                        </button>
                                    </div>
                                    <div class="character-prompts-controls">
                                        <button type="button" id="autoPositionBtn" class="btn-secondary toggle-btn" data-state="on" title="Auto Position" style="display: none;">
                                            <i class="fas fa-arrows-up-down-left-right"></i> Auto
                                        </button>
                                        <button type="button" id="addCharacterBtn" class="btn-secondary">
                                            <i class="nai-plus"></i> Add Character
                                        </button>
                                    </div>
                                </div>
                                <div id="characterPromptsContainer" class="character-prompts-container">
                                </div>
                            </div>

                            <!-- Transformation Section -->
                            <div class="form-row" id="transformationSection">
                                <div id="transformationSectionLeft" class="form-col" style="width: 100%; height: 100%; max-width: 50%;">
                                    <div id="transformationSectionLeftHeader" class="form-row">
                                        <div class="form-group">
                                            <span class="character-prompts-title">Transformation</span>
                                        </div>
                                    </div>
                                    <div id="transformationSectionLeftContent" class="form-row" style="flex: 1 0 auto;">
                                        <div class="variation-image-container">
                                            <img id="manualVariationImage" src="" alt="Source Image" style="max-width: 240px; max-height: 140px;">
                                            <canvas id="maskPreviewCanvas" style="max-width: 240px; max-height: 140px; pointer-events: none;"></canvas>
                                        </div>
                                    </div>
                                </div>
                                <div id="transformationSectionRight" class="form-col">
                                    <div class="form-row" style="align-self: flex-end;">
                                        <button type="button" id="inpaintBtn" class="btn-secondary toggle-btn" data-state="off">
                                            <i class="nai-inpaint"></i> Inpaint
                                        </button>
                                        <!-- Custom Transformation Dropdown -->
                                        <div id="transformationDropdown" class="custom-dropdown dropright">
                                            <button type="button" id="transformationDropdownBtn" class="btn-secondary toggle-btn" data-state="off">
                                                <i class="nai-img2img"></i>
                                                <span id="transformationSelected">Select</span>
                                            </button>
                                            <div id="transformationDropdownMenu" class="custom-dropdown-menu" style="display: none;">
                                                <div class="custom-dropdown-option" data-value="reroll" style="display: none;">
                                                    <i class="nai-img2img"></i> Referance
                                                </div>
                                                <div class="custom-dropdown-option" data-value="variation" style="display: none;">
                                                    <i class="nai-img2img"></i> Current Image
                                                </div>
                                                <div class="custom-dropdown-option" data-value="browse">
                                                    <i class="nai-history"></i> Browse History
                                                </div>
                                                <div class="custom-dropdown-option" data-value="upload">
                                                    <i class="nai-import"></i> Upload Image
                                                </div>
                                            </div>
                                        </div>
                                        <input type="hidden" id="transformationType" value="reroll">
                                        <button type="button" id="deleteImageBaseBtn" class="btn-secondary" style="display: none;">
                                            <i class="nai-thin-cross"></i>
                                        </button>
                                    </div>
                                    <div class="form-row img2img-controls">
                                        <div class="form-group" style="flex: unset;">
                                            <label for="manualStrength">Strength</label>
                                            <input type="number" id="manualStrengthValue" class="form-control hover-show colored slider-value-input" min="0.0" max="1.0" step="0.01" value="0.8" style="width: 60px; margin-right: 10px;" tabindex="0">
                                        </div>
                                        <div class="form-group" style="flex: unset;">
                                            <label for="manualNoise">Noise</label>
                                            <input type="number" id="manualNoiseValue" class="form-control hover-show colored slider-value-input" min="0.0" max="1.0" step="0.01" value="0.1" style="width: 60px; margin-right: 10px;" tabindex="0">
                                        </div>
                                        <div class="form-group" id="manualMaskBiasGroup" style="display: none;">
                                            <label for="manualMaskBias">Mask Bias</label>
                                            <!-- Custom Manual Mask Bias Dropdown -->
                                            <div id="manualMaskBiasDropdown" class="custom-dropdown dropup">
                                                <button type="button" id="manualMaskBiasDropdownBtn" class="custom-dropdown-btn hover-show colored">
                                                    <div class="mask-bias-button-content">
                                                        <div class="mask-bias-grid" data-bias="2" data-orientation="landscape">
                                                            <div class="grid-cell"></div>
                                                            <div class="grid-cell"></div>
                                                            <div class="grid-cell"></div>
                                                            <div class="grid-cell"></div>
                                                            <div class="grid-cell"></div>
                                                            <div class="grid-cell"></div>
                                                            <div class="grid-cell"></div>
                                                            <div class="grid-cell"></div>
                                                            <div class="grid-cell"></div>
                                                            <div class="grid-cell"></div>
                                                            <div class="grid-cell"></div>
                                                            <div class="grid-cell"></div>
                                                            <div class="grid-cell"></div>
                                                            <div class="grid-cell"></div>
                                                            <div class="grid-cell"></div>
                                                            <div class="grid-cell"></div>
                                                            <div class="grid-cell"></div>
                                                            <div class="grid-cell"></div>
                                                            <div class="grid-cell"></div>
                                                            <div class="grid-cell"></div>
                                                            <div class="grid-cell"></div>
                                                            <div class="grid-cell"></div>
                                                            <div class="grid-cell"></div>
                                                        </div>
                                                        <span id="manualMaskBiasSelected">Center</span>
                                                    </div>
                                                </button>
                                                <div id="manualMaskBiasDropdownMenu" class="custom-dropdown-menu" style="display: none;"></div>
                                            </div>
                                            <input type="hidden" id="manualMaskBias" value="2">
                                        </div>
                                        <div class="form-group" id="imageBiasGroup" style="display: none;">
                                            <label for="imageBias">Image Bias</label>
                                            <div style="display: flex; gap: 8px; align-items: center;">
                                                <!-- Custom Image Bias Dropdown -->
                                                <div id="imageBiasDropdown" class="custom-dropdown dropup">
                                                    <button type="button" id="imageBiasDropdownBtn" class="custom-dropdown-btn hover-show colored">
                                                        <div class="mask-bias-button-content">
                                                            <div class="mask-bias-grid" data-bias="2" data-orientation="landscape">
                                                                <div class="grid-cell"></div>
                                                                <div class="grid-cell"></div>
                                                                <div class="grid-cell"></div>
                                                                <div class="grid-cell"></div>
                                                                <div class="grid-cell"></div>
                                                                <div class="grid-cell"></div>
                                                                <div class="grid-cell"></div>
                                                                <div class="grid-cell"></div>
                                                                <div class="grid-cell"></div>
                                                                <div class="grid-cell"></div>
                                                                <div class="grid-cell"></div>
                                                                <div class="grid-cell"></div>
                                                                <div class="grid-cell"></div>
                                                                <div class="grid-cell"></div>
                                                                <div class="grid-cell"></div>
                                                                <div class="grid-cell"></div>
                                                                <div class="grid-cell"></div>
                                                                <div class="grid-cell"></div>
                                                                <div class="grid-cell"></div>
                                                                <div class="grid-cell"></div>
                                                                <div class="grid-cell"></div>
                                                                <div class="grid-cell"></div>
                                                                <div class="grid-cell"></div>
                                                                <div class="grid-cell"></div>
                                                                <div class="grid-cell"></div>
                                                            </div>
                                                            <span id="imageBiasSelected">Center</span>
                                                        </div>
                                                    </button>
                                                    <div id="imageBiasDropdownMenu" class="custom-dropdown-menu" style="display: none;"></div>
                                                </div>
                                                <!-- Advanced Bias Adjustment Button -->
                                                <button type="button" id="imageBiasAdjustBtn" class="btn-secondary" title="Advanced Bias Adjustment">
                                                    <i class="nai-resize    "></i>
                                                </button>
                                            </div>
                                            <input type="hidden" id="imageBias" value="2">
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="form-section model-control">
                            <div class="form-row">
                                <div class="form-group" id="manualModelGroup">
                                    <label for="manualModel">Model</label>
                                    <div id="manualModelDropdown" class="custom-dropdown dropup">
                                        <button type="button" id="manualModelDropdownBtn" class="custom-dropdown-btn hover-show colored">
                                            <span id="manualModelSelected">Select model...</span>
                                        </button>
                                        <div id="manualModelDropdownMenu" class="custom-dropdown-menu" style="display: none;"></div>
                                    </div>
                                    <input type="hidden" id="manualModel" value="">
                                </div>
                                <div id="manualResolutionGroup" class="form-group">
                                    <label for="manualResolution">Resolution</label>
                                    <div class="resolution-group">
                                        <div id="manualResolutionDropdown" class="custom-dropdown dropup">
                                            <button type="button" id="manualResolutionDropdownBtn" class="custom-dropdown-btn hover-show colored">
                                                <span id="manualResolutionSelected">Select resolution...</span>
                                            </button>
                                            <div id="manualResolutionDropdownMenu" class="custom-dropdown-menu" style="display: none;"></div>
                                        </div>
                                        <input type="hidden" id="manualResolution" value="">
                                        <div id="manualCustomResolution" class="custom-resolution-inputs" style="display: none;">
                                            <button type="button" id="manualCustomResolutionBtn" class="btn-secondary toggle-btn" data-state="off" title="Custom Resolution">
                                                <i class="fas fa-ruler-combined"></i>
                                            </button>
                                            <input type="number" id="manualWidth" class="colored form-control hover-show" placeholder="Width" min="512" max="2048" step="8">
                                            <span style="color: #ccc;">Ã—</span>
                                            <input type="number" id="manualHeight" class="colored form-control hover-show" placeholder="Height" min="512" max="2048" step="8">
                                        </div>
                                        <button type="button" id="manualUpscale" class="btn-secondary toggle-btn" data-state="off" title="Enable upscaling">
                                            <i class="nai-upscale"></i>
                                        </button>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="manualSeed">Seed</label>
                                    <div class="seed-input-group">
                                        <input type="number" id="manualSeed" class="form-control hover-show colored" placeholder="Randomize">
                                        <button type="button" id="clearSeedBtn" class="btn-secondary" title="Clear seed">
                                            <i class="nai-thin-cross"></i>
                                        </button>
                                        <button type="button" id="sproutSeedBtn" class="btn-secondary toggle-btn" data-state="off" title="Fill with seed value" style="display: none;">
                                            <i class="nai-seed"></i>
                                        </button>
                                        <button type="button" id="layer1SeedToggle" class="btn-secondary toggle-btn" data-state="off" title="Use Layer 1 Seed">
                                            <i class="fas fa-l"></i>
                                            <i class="fas fa-1"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>

                            <div class="form-row">
                                <div class="form-group">
                                    <label for="manualSteps">Steps</label>
                                    <input type="number" id="manualSteps" class="form-control hover-show colored" min="1" max="28" value="25" placeholder="25">
                                </div>
                                <div class="form-group">
                                    <label for="manualGuidance">Guidance</label>
                                    <div class="guidance-group" style="display: flex; align-items: center; gap: 6px;">
                                        <input type="number" id="manualGuidance" class="form-control hover-show colored" min="0.0" max="10.0" step="0.01" value="5.0" placeholder="5.0">
                                        <button type="button" id="varietyBtn" class="btn-secondary toggle-btn" title="Enable Variety+">
                                            <i class="nai-easel"></i>
                                        </button>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="manualRescale">Rescale</label>
                                    <input type="number" id="manualRescale" class="form-control hover-show colored" min="0.0" max="1.0" step="0.01" value="0.0" placeholder="0.0">
                                </div>
                                <div class="form-group">
                                    <label for="manualSampler">Sampler</label>
                                    <!-- Custom Manual Sampler Dropdown -->
                                    <div id="manualSamplerDropdown" class="custom-dropdown dropup">
                                        <button type="button" id="manualSamplerDropdownBtn" class="custom-dropdown-btn hover-show colored">
                                            <span id="manualSamplerSelected">Select sampler...</span>
                                        </button>
                                        <div id="manualSamplerDropdownMenu" class="custom-dropdown-menu" style="display: none;"></div>
                                    </div>
                                    <input type="hidden" id="manualSampler" value="">
                                </div>
                                <div class="form-group">
                                    <label for="manualNoiseScheduler">Noise Scheduler</label>
                                    <!-- Custom Manual Noise Scheduler Dropdown -->
                                    <div id="manualNoiseSchedulerDropdown" class="custom-dropdown dropup">
                                        <button type="button" id="manualNoiseSchedulerDropdownBtn" class="custom-dropdown-btn hover-show colored">
                                            <span id="manualNoiseSchedulerSelected">Select noise scheduler...</span>
                                        </button>
                                        <div id="manualNoiseSchedulerDropdownMenu" class="custom-dropdown-menu" style="display: none;"></div>
                                    </div>
                                    <input type="hidden" id="manualNoiseScheduler" value="">
                                </div>

                            </div>

                            <div id="manualPresetGroup" class="form-row">
                                <div class="form-group">
                                    <label for="manualPresetName">Preset Name</label>
                                    <input type="text" id="manualPresetName" class="form-control hover-show colored" placeholder="Enter preset name to save...">
                                </div>
                                <div class="form-group" style="flex: unset;">
                                    <label>&nbsp;</label>
                                    <button type="button" id="manualLoadBtn" class="btn-secondary" disabled>
                                        <i class="nai-import"></i> Load
                                    </button>
                                </div>
                                <div class="form-group" style="flex: unset;">
                                    <label>&nbsp;</label>
                                    <button type="button" id="manualSaveBtn" class="btn-secondary">
                                        <i class="nai-save"></i> Save
                                    </button>
                                </div>
                            </div>

                            <div class="form-actions btn-group">
                                <div class="footer-left">
                                    <div id="manualPriceDisplay" class="price-display badge" style="display: none;">
                                        <i class="nai-anla"></i>
                                        <span id="manualPriceList" class="price-list">-</span>
                                    </div>
                                    <button type="button" id="paidRequestToggle" class="btn-secondary toggle-btn" data-state="off" title="Force Paid Request">
                                        <i class="fas fa-dollar-sign"></i>
                                    </button>
                                    <!-- Preset Toggle Button -->
                                    <button type="button" id="manualPresetToggleBtn" class="btn-secondary hover-show">
                                        <span id="manualPresetToggleText"></span>
                                        <i id="manualPresetToggleIcon" class="nai-dotdotdot"></i>
                                    </button>
                                </div>
                                <button type="button" id="closeManualBtn" class="btn-secondary">Cancel</button>
                                <button type="submit" id="manualGenerateBtn" class="btn-primary">
                                    <i class="nai-sparkles"></i> Generate
                                </button>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="manual-modal-preview-section" id="manualPanelSection">
                    <div class="manual-preview-container" id="manualPreviewContainer">
                        <!-- Manual Modal Loading Overlay -->
                        <div id="manualLoadingOverlay" class="manual-loading-overlay hidden">
                            <div class="manual-loading-content">
                                <div class="spinner"></div>
                                <p>Generating your image...</p>
                            </div>
                        </div>
                        <div class="manual-preview-content">
                            <!-- Navigation buttons -->
                            <div class="manual-preview-image-container">
                                <img id="manualPreviewImage" src="" alt="Generated Image" style="display: none;">
                                <div id="manualPreviewPlaceholder" class="manual-preview-placeholder">
                                    <i class="nai-image-placeholder-odd"></i>
                                    <p>Generate an image to see preview</p>
                                </div>
                            </div>
                            <div class="manual-preview-controls">
                                <button id="manualPreviewDownloadBtn" class="btn-primary round-button" style="display: none;">
                                    <i class="nai-save"></i>
                                </button>
                                <button id="manualPreviewUpscaleBtn" class="btn-primary round-button" style="display: none;">
                                    <i class="nai-upscale"></i>
                                </button>
                                <button id="manualPreviewVariationBtn" class="btn-primary round-button" style="display: none;">
                                    <i class="nai-inpaint"></i>
                                </button>
                                <button id="manualPreviewLoadBtn" class="btn-primary round-button" style="display: none;">
                                    <i class="nai-settings"></i>
                                </button>
                                <button id="manualPreviewDeleteBtn" class="btn-danger round-button" style="display: none;">
                                    <i class="nai-trash"></i>
                                </button>
                            </div>
                            <div class="manual-preview-controls-top-right">
                                <button id="manualPreviewCloseBtn" class="btn-primary round-button">
                                    <i class="nai-thin-cross"></i>
                                </button>
                            </div>
                            <div class="manual-preview-controls-left">
                                <button id="manualPreviewPrevBtn" class="btn-primary round-button" disabled>
                                    <i class="nai-directional-arrow-left"></i>
                                </button>
                                <button id="manualPreviewNextBtn" class="btn-primary round-button" disabled>
                                    <i class="nai-directional-arrow-right"></i>
                                </button>
                            </div>
                            <div class="manual-preview-controls-right">
                                <div id="manualPreviewSeedBtn" class="preview-info-badge">
                                    <i class="nai-seed"></i>
                                    <span id="manualPreviewSeedNumber">---</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- Cache Browser Container (Desktop Only) -->
                    <div id="cacheBrowserContainer" class="cache-browser-container">
                        <div class="cache-browser-header">
                            <h3>Browse Cache Images</h3>
                            <button id="closeCacheBrowserContainerBtn" class="close-dialog">&times;</button>
                        </div>
                        <div class="cache-browser-body">
                            <div id="cacheGalleryContainer" class="cache-gallery">
                                <!-- Cache images will be loaded here -->
                            </div>
                            <div class="cache-browser-loading" id="cacheBrowserLoadingContainer" style="display: none;">
                                <div class="spinner"></div>
                                <p>Loading cache images...</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Character Autocomplete Overlay -->
    <div id="characterAutocompleteOverlay" class="character-autocomplete-overlay hidden">
        <div class="character-autocomplete-list">
            <!-- Character suggestions will be populated here -->
        </div>
    </div>

    <!-- Preset Autocomplete Overlay -->
    <div id="presetAutocompleteOverlay" class="preset-autocomplete-overlay hidden size-small">
        <div class="preset-autocomplete-list">
            <!-- Preset suggestions will be populated here -->
        </div>
    </div>

    <!-- Position Dialog Modal -->
    <div id="positionDialog" class="modal">
        <div class="modal-content position-dialog-content center">
            <div class="position-dialog-body">
                <div class="position-grid">
                    <div class="position-row">
                        <div class="position-cell" data-x="0.1" data-y="0.1" data-cell="A1">A1</div>
                        <div class="position-cell" data-x="0.3" data-y="0.1" data-cell="B1">B1</div>
                        <div class="position-cell" data-x="0.5" data-y="0.1" data-cell="C1">C1</div>
                        <div class="position-cell" data-x="0.7" data-y="0.1" data-cell="D1">D1</div>
                        <div class="position-cell" data-x="0.9" data-y="0.1" data-cell="E1">E1</div>
                    </div>
                    <div class="position-row">
                        <div class="position-cell" data-x="0.1" data-y="0.3" data-cell="A2">A2</div>
                        <div class="position-cell" data-x="0.3" data-y="0.3" data-cell="B2">B2</div>
                        <div class="position-cell" data-x="0.5" data-y="0.3" data-cell="C2">C2</div>
                        <div class="position-cell" data-x="0.7" data-y="0.3" data-cell="D2">D2</div>
                        <div class="position-cell" data-x="0.9" data-y="0.3" data-cell="E2">E2</div>
                    </div>
                    <div class="position-row">
                        <div class="position-cell" data-x="0.1" data-y="0.5" data-cell="A3">A3</div>
                        <div class="position-cell" data-x="0.3" data-y="0.5" data-cell="B3">B3</div>
                        <div class="position-cell" data-x="0.5" data-y="0.5" data-cell="C3">C3</div>
                        <div class="position-cell" data-x="0.7" data-y="0.5" data-cell="D3">D3</div>
                        <div class="position-cell" data-x="0.9" data-y="0.5" data-cell="E3">E3</div>
                    </div>
                    <div class="position-row">
                        <div class="position-cell" data-x="0.1" data-y="0.7" data-cell="A4">A4</div>
                        <div class="position-cell" data-x="0.3" data-y="0.7" data-cell="B4">B4</div>
                        <div class="position-cell" data-x="0.5" data-y="0.7" data-cell="C4">C4</div>
                        <div class="position-cell" data-x="0.7" data-y="0.7" data-cell="D4">D4</div>
                        <div class="position-cell" data-x="0.9" data-y="0.7" data-cell="E4">E4</div>
                    </div>
                    <div class="position-row">
                        <div class="position-cell" data-x="0.1" data-y="0.9" data-cell="A5">A5</div>
                        <div class="position-cell" data-x="0.3" data-y="0.9" data-cell="B5">B5</div>
                        <div class="position-cell" data-x="0.5" data-y="0.9" data-cell="C5">C5</div>
                        <div class="position-cell" data-x="0.7" data-y="0.9" data-cell="D5">D5</div>
                        <div class="position-cell" data-x="0.9" data-y="0.9" data-cell="E5">E5</div>
                    </div>
                </div>
                <div class="position-dialog-actions">
                    <button type="button" id="confirmPositionBtn" class="btn-primary">Confirm Position</button>
                    <button type="button" id="cancelPositionBtn" class="btn-secondary">Cancel</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Mask Editor Dialog Modal -->
    <div id="maskEditorDialog" class="modal">
        <div class="modal-content mask-editor-content">
            <div class="mask-editor-body">
                <div class="mask-editor-tools">
                    <h3>Mask Editor</h3>
                    <button type="button" id="maskBrushBtn" class="btn-secondary toggle-btn" data-state="on" title="Brush Tool">
                        <i class="fas fa-paint-brush"></i> Brush
                    </button>
                    <button type="button" id="maskEraserBtn" class="btn-secondary toggle-btn" data-state="off" title="Eraser Tool">
                        <i class="fas fa-eraser"></i> Eraser
                    </button>
                    <button type="button" id="brushShapeBtn" class="btn-secondary" title="Toggle Brush Shape">
                        <i class="fas fa-square"></i>
                    </button>
                    <div class="brush-size-control">
                        <input type="number" id="brushSize" class="form-control hover-show colored" min="1" max="20" value="3" style="width: 50px;">
                    </div>
                    <button type="button" id="clearMaskBtn" class="btn-secondary" title="Clear Mask">
                        <i class="fas fa-trash"></i> Clear
                    </button>
                </div>
                <div class="mask-editor-canvas-container">
                    <div class="mask-editor-canvas-inner" id="maskEditorCanvasInner">
                        <canvas id="maskCanvas" width="64" height="64"></canvas>
                    </div>
                </div>
                <div class="mask-editor-actions">
                    <button type="button" id="deleteMaskBtn" class="btn-danger">Delete Mask</button>
                    <button type="button" id="saveMaskBtn" class="btn-primary">Save Mask</button>
                    <button type="button" id="cancelMaskBtn" class="btn-secondary">Cancel</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Image Bias Adjustment Modal -->
    <div id="imageBiasAdjustmentModal" class="modal">
        <div class="modal-content image-bias-adjustment-content">
            <div class="image-bias-adjustment-body">
                <!-- Bias Controls Section -->
                <div class="bias-controls-section main-controls">
                    <h3>Image Bias</h3>
                    <div class="bias-controls-grid">
                        <div class="bias-control-group">
                            <label for="biasX">X Position</label>
                            <input type="number" id="biasX" class="form-control hover-show colored" min="0" max="2048" step="1" value="0">
                        </div>
                        <div class="bias-control-group">
                            <label for="biasY">Y Position</label>
                            <input type="number" id="biasY" class="form-control hover-show colored" min="0" max="2048" step="1" value="0">
                        </div>
                        <div class="bias-control-group">
                            <label for="biasScale">Scale</label>
                            <input type="number" id="biasScale" class="form-control hover-show colored" min="0.1" max="3.0" step="0.01" value="1.0">
                        </div>
                        <div class="bias-control-group">
                            <label for="biasRotate">Rotate</label>
                            <input type="number" id="biasRotate" class="form-control hover-show colored" min="-180" max="180" step="1" value="0">
                        </div>
                        <div class="bias-control-group">
                            <label>&nbsp;</label>
                            <div style="display: flex; gap: 8px; align-items: center; margin-right: auto;">
                                <div class="custom-dropdown" id="imageBiasPresetDropdown">
                                    <button type="button" class="btn-secondary" id="imageBiasPresetBtn">
                                        <span class="mask-bias-label">Preset</span>
                                    </button>
                                    <div class="custom-dropdown-menu" id="imageBiasPresetMenu" style="display: none;"></div>
                                </div>
                            </div>
                        </div>
                        <div class="bias-control-group" style="margin-left: auto;">
                            <label>&nbsp;</label>
                            <div style="display: flex; gap: 8px; align-items: center;">
                                <button type="button" id="biasResetBtn" class="btn-secondary">
                                    <i class="nai-reload"></i> Reset
                                </button>
                                <button type="button" id="previewToggleBtn" class="btn-secondary toggle-btn" data-state="off">
                                    <i class="nai-sparkles"></i> Client Preview
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Image Preview Section -->
                <div class="image-preview-section">
                    <div class="image-preview-container" id="imagePreviewContainer">
                        <div class="target-area-overlay" id="targetAreaOverlay">
                            <div class="target-area-border"></div>
                        </div>
                        <div id="biasAdjustmentImageWrapper" class="bias-adjustment-image-wrapper">
                            <img id="biasAdjustmentImage" src="" alt="Base Image" class="bias-adjustment-image">
                        </div>
                        <img id="clientPreviewImage" src="" alt="Client Preview" class="client-preview-image" style="display: none;">
                    </div>
                </div>
            </div>
            <div class="image-bias-adjustment-actions">
                <button type="button" id="cancelBiasAdjustmentBtn" class="btn-secondary">Cancel</button>
                <button type="button" id="saveBiasAdjustmentBtn" class="btn-primary">Save Adjustment</button>
            </div>
        </div>
    </div>

    <!-- Image Bias Adjustment Confirmation Dialog -->
    <div id="biasAdjustmentConfirmDialog" class="modal alert-theme">
        <div class="modal-content bias-confirm-content center">
            <div class="bias-confirm-header">
                <h3>Confirm Bias Adjustment</h3>
                <button id="closeBiasConfirmBtn" class="close-dialog">&times;</button>
            </div>
            <div class="bias-confirm-body">
                <p>Review the previews below to confirm your bias adjustment:</p>
                <div class="bias-confirm-previews">
                    <div class="preview-section">
                        <h4>Client Preview</h4>
                        <div class="preview-image-container">
                            <img id="confirmClientPreview" src="" alt="Client Preview">
                        </div>
                    </div>
                    <div class="preview-section">
                        <h4>Server Preview</h4>
                        <div class="preview-image-container">
                            <img id="confirmServerPreview" src="" alt="Server Preview">
                        </div>
                    </div>
                </div>
            </div>
            <div class="bias-confirm-actions">
                <button type="button" id="cancelBiasConfirmBtn" class="btn-secondary">Cancel</button>
                <button type="button" id="acceptBiasConfirmBtn" class="btn-primary">Accept & Save</button>
            </div>
        </div>
    </div>

    <!-- Mask Adjustment Modal -->
    <div id="maskAdjustmentModal" class="modal alert-theme">
        <div class="modal-content mask-adjustment-content center">
            <div class="mask-adjustment-header">
                <h3>Mask Adjustment Required</h3>
                <button id="closeMaskAdjustmentBtn" class="close-dialog">&times;</button>
            </div>
            <div class="mask-adjustment-body">
                <p>The image bias adjustment has changed the image composition. Your existing mask may no longer match the new image layout.</p>
                <p>Would you like to:</p>
                <div class="mask-adjustment-options">
                    <button type="button" id="editMaskBtn" class="btn-primary">
                        <i class="fas fa-edit"></i> Edit Mask
                    </button>
                    <button type="button" id="autoFillMaskBtn" class="btn-secondary">
                        <i class="fas fa-magic"></i> Auto Correct Mask
                    </button>
                    <button type="button" id="skipMaskAdjustmentBtn" class="btn-secondary">
                        <i class="fas fa-times"></i> Skip
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Character Data Confirmation Modal -->
    <div id="characterDataConfirmModal" class="modal alert-theme">
        <div class="modal-content center">
            <div class="modal-header">
                <h3>Character Data Detected</h3>
                <button id="closeCharacterDataConfirmBtn" class="close-dialog">&times;</button>
            </div>
            <div class="modal-body">
                <p>You have character prompt data that won't be processed by V3 models.</p>
                <p>Would you like to:</p>
                <div class="modal-actions">
                    <button type="button" id="includeCharacterDataBtn" class="btn-secondary">
                        <i class="fas fa-save"></i> Keep Character Data (Stored but not processed)
                    </button>
                    <button type="button" id="removeCharacterDataBtn" class="btn-primary">
                        <i class="fas fa-trash"></i> Remove Character Data
                    </button>
                    <button type="button" id="cancelGenerationBtn" class="btn-danger">
                        <i class="fas fa-times"></i> Cancel Generation
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Lightbox Modal -->
    <div id="lightboxModal" class="lightbox-modal">
        <!-- Top left toggle button for base image -->
        <button id="toggleBaseImageBtn" class="lightbox-toggle-btn" style="display:none;">
            <i class="fas fa-exchange-alt"></i> <span>Show Base</span>
        </button>
        
        <!-- Close button overlay -->
        <button id="closeLightboxBtn" class="lightbox-close-btn">
            <i class="nai-thin-cross"></i>
        </button>
        
        <div class="lightbox-container">
            <!-- Main content area with image and prompt panel side by side -->
            <div class="lightbox-main-content">
                <!-- Image and Controls Section -->
                <div class="lightbox-image-section">
                    <div class="lightbox-image-container">
                        <img id="lightboxImage" src="" alt="Generated Image">
                    </div>
                    
                    <!-- Controls Section -->
                    <div class="lightbox-controls-section">
                        <div class="lightbox-controls">
                            <button id="downloadBtn" class="btn-primary round-button">
                                <i class="nai-save"></i>
                            </button>
                            <button id="lightboxUpscaleBtn" class="btn-primary round-button" style="display:none;">
                                <i class="nai-upscale"></i>
                            </button>
                            <button id="lightboxRerollBtn" class="btn-primary round-button" style="display:none;">
                                <i class="nai-dice"></i>
                            </button>
                            <button id="lightboxVariationBtn" class="btn-primary round-button" style="display:none;">
                                <i class="nai-inpaint"></i>
                            </button>
                            <button id="lightboxRerollEditBtn" class="btn-primary round-button" style="display:none;">
                                <i class="nai-settings"></i>
                            </button>
                            <button id="lightboxScrapBtn" class="btn-secondary round-button" style="display:none;">
                                <i class="nai-image-tool-sketch"></i>
                            </button>
                            <button id="metadataBtn" class="btn-secondary metadata-btn-mobile round-button">
                                <i class="fas fa-info-circle"></i>
                            </button>
                            <button id="lightboxDeleteBtn" class="btn-danger round-button" style="display:none;">
                                <i class="nai-trash"></i>
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Prompt Panel (Right Side) -->
                <div id="promptPanel" class="prompt-panel hidden">
                    <div class="prompt-panel-content">
                        <div id="allPromptsContent" class="character-prompts-list">
                            <!-- All prompts will be populated here -->
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Metadata Section -->
            <div class="lightbox-metadata-section">
                <div class="metadata-table-container">
                    <div class="metadata-grid">
                        <!-- Row 1: Type, Name, Model, Resolution -->
                        <div class="metadata-row">
                            <div class="metadata-cell metadata-small">
                                <span class="metadata-label">Type</span>
                                <span id="metadataType" class="metadata-value">-</span>
                            </div>
                            <div class="metadata-cell metadata-small">
                                <span class="metadata-label">Name</span>
                                <span id="metadataName" class="metadata-value">-</span>
                            </div>
                            <div class="metadata-cell">
                                <span class="metadata-label">Model</span>
                                <div class="metadata-model-content">
                                    <span id="metadataModel" class="metadata-value">-</span>
                                    <div class="metadata-buttons">
                                        <button id="promptBtn" class="metadata-btn">Prompts</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Row 2: Steps, Guidance, Seed 1, Seed 2, Sampler, Rescale, Noise Schedule -->
                        <div class="metadata-row">
                            <div class="metadata-cell metadata-small">
                                <span class="metadata-label">Resolution</span>
                                <span id="metadataResolution" class="metadata-value">-</span>
                            </div>
                            
                            <div class="metadata-cell metadata-small">
                                <span class="metadata-label">Seed 1</span>
                                <span id="metadataSeed1" class="metadata-value">-</span>
                            </div>
                            <div class="metadata-cell metadata-small">
                                <span class="metadata-label">Seed 2</span>
                                <span id="metadataSeed2" class="metadata-value">-</span>
                            </div>
                            <div class="metadata-cell metadata-very-small">
                                <span class="metadata-label">Steps</span>
                                <span id="metadataSteps" class="metadata-value">-</span>
                            </div>
                            <div class="metadata-cell metadata-very-small">
                                <span class="metadata-label">Guidance</span>
                                <span id="metadataGuidance" class="metadata-value">-</span>
                            </div>
                            <div class="metadata-cell metadata-very-small"> 
                                <span class="metadata-label">Rescale</span>
                                <span id="metadataRescale" class="metadata-value">-</span>
                            </div>
                            <div class="metadata-cell">
                                <span class="metadata-label">Sampler</span>
                                <span id="metadataSampler" class="metadata-value">-</span>
                            </div>
                            <div class="metadata-cell">
                                <span class="metadata-label">Noise Schedule</span>
                                <span id="metadataNoiseSchedule" class="metadata-value">-</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Expandable prompt/UC sections -->
                    <div id="promptExpanded" class="metadata-expanded" style="display: none;">
                        <div class="metadata-expanded-header">
                            <span>Prompt</span>
                            <button class="close-expanded">&times;</button>
                        </div>
                        <div id="promptContent" class="metadata-expanded-content"></div>
                    </div>
                    
                    <div id="ucExpanded" class="metadata-expanded" style="display: none;">
                        <div class="metadata-expanded-header">
                            <span>Undesired Content</span>
                            <button class="close-expanded">&times;</button>
                        </div>
                        <div id="ucContent" class="metadata-expanded-content"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Metadata Dialog (Mobile Only) -->
    <div id="metadataDialog" class="metadata-dialog">
        <div class="metadata-dialog-content">
            <div class="metadata-dialog-header">
                <h3>Image Metadata</h3>
                <button id="closeMetadataDialog" class="close-dialog">&times;</button>
            </div>
            <div class="metadata-dialog-body">
                <div class="metadata-table-container">
                    <div class="metadata-grid">
                        <!-- Row 1: Type, Name, Model, Resolution -->
                        <div class="metadata-row">
                            <div class="metadata-cell">
                                <span class="metadata-label">Type</span>
                                <span id="dialogMetadataType" class="metadata-value">-</span>
                            </div>
                            <div class="metadata-cell">
                                <span class="metadata-label">Name</span>
                                <span id="dialogMetadataName" class="metadata-value">-</span>
                            </div>
                            <div class="metadata-cell metadata-model-cell">
                                <span class="metadata-label">Model</span>
                                <div class="metadata-model-content">
                                    <span id="dialogMetadataModel" class="metadata-value">-</span>
                                    <div class="metadata-buttons">
                                        <button id="dialogPromptBtn" class="metadata-btn">Prompts</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Row 2: Steps, Guidance, Seed 1, Seed 2, Sampler, Rescale, Noise Schedule -->
                        <div class="metadata-row">
                            <div class="metadata-cell">
                                <span class="metadata-label">Resolution</span>
                                <span id="dialogMetadataResolution" class="metadata-value">-</span>
                            </div>
                            <div class="metadata-cell">
                                <span class="metadata-label">Seed 1</span>
                                <span id="dialogMetadataSeed1" class="metadata-value">-</span>
                            </div>
                            <div class="metadata-cell">
                                <span class="metadata-label">Seed 2</span>
                                <span id="dialogMetadataSeed2" class="metadata-value">-</span>
                            </div>
                            <div class="metadata-cell">
                                <span class="metadata-label">Steps</span>
                                <span id="dialogMetadataSteps" class="metadata-value">-</span>
                            </div>
                            <div class="metadata-cell">
                                <span class="metadata-label">Guidance</span>
                                <span id="dialogMetadataGuidance" class="metadata-value">-</span>
                            </div>
                            <div class="metadata-cell">
                                <span class="metadata-label">Rescale</span>
                                <span id="dialogMetadataRescale" class="metadata-value">-</span>
                            </div>
                            <div class="metadata-cell">
                                <span class="metadata-label">Sampler</span>
                                <span id="dialogMetadataSampler" class="metadata-value">-</span>
                            </div>
                            <div class="metadata-cell">
                                <span class="metadata-label">Noise Schedule</span>
                                <span id="dialogMetadataNoiseSchedule" class="metadata-value">-</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Expandable prompt/UC sections -->
                    <div id="dialogPromptExpanded" class="metadata-expanded" style="display: none;">
                        <div class="metadata-expanded-header">
                            <span>Prompt</span>
                            <button class="close-expanded">&times;</button>
                        </div>
                        <div id="dialogPromptContent" class="metadata-expanded-content"></div>
                    </div>
                    
                    <div id="dialogUcExpanded" class="metadata-expanded" style="display: none;">
                        <div class="metadata-expanded-header">
                            <span>Undesired Content</span>
                            <button class="close-expanded">&times;</button>
                        </div>
                        <div id="dialogUcContent" class="metadata-expanded-content"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- Header -->
    <header class="header">
        <div class="header-left">
            <span class="menu-logo">
                <i class="nai-wand-sparkles"></i>
                <span class="logo-text">StaticForge</span>
            </span>
            <div class="workspace-controls">
                <!-- Workspace Dropdown -->
                <div id="workspaceDropdown" class="custom-dropdown">
                    <button type="button" id="workspaceDropdownBtn" class="btn-secondary">
                        <i class="fas fa-folder"></i>
                        <span id="workspaceSelected">Default</span>
                    </button>
                    <div id="workspaceDropdownMenu" class="custom-dropdown-menu" style="display: none;">
                        <!-- Workspace options will be populated here -->
                    </div>
                </div>
                <!-- Workspace Action Buttons -->
                <button type="button" id="workspaceAddBtn" class="btn-secondary" title="Add Workspace">
                    <i class="fas fa-plus"></i>
                </button>
                <button type="button" id="workspaceManageBtn" class="btn-secondary" title="Manage Workspaces">
                    <i class="fas fa-cog"></i>
                </button>
            </div>
            <button id="galleryToggleBtn" class="btn-secondary toggle-btn" data-state="off" data-state="images" title="Toggle between Images and Scraps">
                <i class="nai-sparkles"></i> Images
            </button>
            <input type="number" id="galleryColumnsInput" class="form-control hover-show colored" min="3" max="10" value="5" style="width: 42px;">
        </div>
        <div class="header-controls">
            <div id="customPresetDropdown" class="custom-dropdown">
                <button type="button" id="customPresetDropdownBtn" class="btn-secondary">
                    <span id="customPresetSelected"><i class="nai-pen-tip-light"></i> Select Preset or Pipeline</span>
                </button>
                <div id="customPresetDropdownMenu" class="custom-dropdown-menu" style="display: none;"></div>
            </div>
            <input type="hidden" id="presetSelect" value="">
            <button id="maskPreviewBtn" class="btn-secondary" style="display: none;">
                <i class="fas fa-eye"></i>
            </button>
            <select id="maskBiasDropdown" class="form-control" style="display: none; width: auto; min-width: 120px;">
                <option value="0">Left/Top</option>
                <option value="1">Left-Mid/Top-Mid</option>
                <option value="2" selected>Center</option>
                <option value="3">Right-Mid/Bottom-Mid</option>
                <option value="4">Right/Bottom</option>
            </select>
            <button id="uploadBtn" class="btn-secondary" title="Upload Image (or paste from clipboard)">
                <i class="nai-import"></i> Import
            </button>
            <button id="manualBtn" class="btn-secondary">
                <i class="nai-penwriting"></i> Editor
            </button>
            <button id="generateBtn" class="btn-primary" disabled>
                <i class="nai-sparkles"></i> Generate
            </button>
            
            <div id="balanceDisplay" class="balance-display" title="Loading balance...">
                <i class="nai-anla"></i>
                <span id="balanceAmount">-</span>
            </div>
            <button id="logoutButton" class="btn-primary">
                <i class="nai-logout"></i> Logout
            </button>
        </div>
    </header>

    <!-- Main Container -->
    <div class="container">

        <!-- Gallery -->
        <div class="gallery-container">
            
            <!-- Bulk Actions Bar -->
            <div id="bulkActionsBar" class="bulk-actions-bar" style="display: none;">
                <div class="bulk-actions-info">
                    <span id="selectedCount">0</span> images selected
                </div>
                <div class="bulk-actions-buttons">
                    <button id="bulkDeleteBtn" class="btn-danger">
                        <i class="nai-trash"></i> Delete
                    </button>
                    <button id="bulkSequenziaBtn" class="btn-primary">
                        <i class="fas fa-share"></i> Bounce
                    </button>
                    <button id="bulkMoveToWorkspaceBtn" class="btn-primary">
                        <i class="fas fa-folder"></i> Transfer
                    </button>
                    <button id="bulkSelectAllBtn" class="btn-secondary">
                        <i class="fas fa-check-double"></i>
                    </button>
                    <button id="clearSelectionBtn" class="btn-secondary">
                        <i class="nai-thin-cross"></i>
                    </button>
                </div>
            </div>
            
            <div id="gallery" class="gallery">
                <!-- Images will be loaded here -->
            </div>
            
            <!-- Loading indicator for infinite scroll -->
            <div id="infiniteScrollLoading" class="infinite-scroll-loading" style="display: none;">
                <div class="spinner"></div>
                <p>Loading more images...</p>
            </div>
        </div>

        <!-- Loading Overlay -->
        <div id="loadingOverlay" class="loading-overlay hidden">
            <div class="loading-content">
                <div class="spinner"></div>
                <p>Generating your image...</p>
            </div>
        </div>
    </div>

    <!-- Cache Browser Modal -->
    <div id="cacheBrowserModal" class="modal">
        <div class="modal-content cache-browser-content">
            <div class="cache-browser-header">
                <h3>Browse Cache Images</h3>
                <button id="closeCacheBrowserBtn" class="close-dialog">&times;</button>
            </div>
            <div class="cache-browser-body">
                <div id="cacheGallery" class="cache-gallery">
                    <!-- Cache images will be loaded here -->
                </div>
                <div class="cache-browser-loading" id="cacheBrowserLoading" style="display: none;">
                    <div class="spinner"></div>
                    <p>Loading cache images...</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Workspace Management Modal -->
    <div id="workspaceManageModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Workspace Management</h3>
                <button id="closeWorkspaceManageBtn" class="close-dialog">&times;</button>
            </div>
            <div class="modal-body">
                <div class="workspace-management-section">
                    <h4>Active Workspaces</h4>
                    <div id="workspaceManageList" class="workspace-manage-list">
                        <!-- Workspace management items will be populated here -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Add/Rename Workspace Modal -->
    <div id="workspaceEditModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="workspaceEditTitle">Add Workspace</h3>
                <button id="closeWorkspaceEditBtn" class="close-dialog">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="workspaceNameInput">Workspace Name</label>
                    <input type="text" id="workspaceNameInput" class="form-control" placeholder="Enter workspace name..." maxlength="50">
                </div>
                <div class="form-group">
                    <label for="workspaceColorInput">Workspace Color</label>
                    <input type="color" id="workspaceColorInput" class="form-control" value="#124">
                    <small class="form-text">Main color for the workspace theme</small>
                </div>
                <div class="form-group">
                    <label for="workspaceBackgroundColorInput">Background Color</label>
                    <input type="color" id="workspaceBackgroundColorInput" class="form-control" value="#0a1a2a">
                    <small class="form-text">Optional: Custom background color overlay</small>
                </div>
                <div class="form-group">
                    <label for="workspaceBackgroundImageInput">Background Image</label>
                    <div class="background-image-selector">
                        <input type="text" id="workspaceBackgroundImageInput" class="form-control" readonly placeholder="No background image selected">
                        <button type="button" id="selectBackgroundImageBtn" class="btn-secondary">
                            <i class="fas fa-images"></i> Select Image
                        </button>
                    </div>
                    <small class="form-text">Optional: Image from this workspace to use as background</small>
                </div>
                <div class="form-group">
                    <label for="workspaceBackgroundOpacityInput">Background Opacity</label>
                    <input type="range" id="workspaceBackgroundOpacityInput" class="form-control" min="0" max="1" step="0.1" value="0.3">
                    <div class="opacity-display">
                        <span id="opacityValue">30%</span>
                    </div>
                    <small class="form-text">Opacity of the background color overlay and circles</small>
                </div>
                <div class="modal-actions">
                    <button type="button" id="workspaceSaveBtn" class="btn-primary">
                        <i class="fas fa-save"></i> Save
                    </button>
                    <button type="button" id="workspaceCancelBtn" class="btn-secondary">
                        Cancel
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Workspace Dump Modal -->
    <div id="workspaceDumpModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Dump Workspace</h3>
                <button id="closeWorkspaceDumpBtn" class="close-dialog">&times;</button>
            </div>
            <div class="modal-body">
                <p>Select the target workspace to merge all items from <strong id="dumpSourceWorkspaceName"></strong>:</p>
                <div class="form-group">
                    <label for="dumpTargetSelect">Target Workspace</label>
                    <select id="dumpTargetSelect" class="form-control">
                        <!-- Options will be populated here -->
                    </select>
                </div>
                <div class="modal-actions">
                    <button type="button" id="workspaceDumpConfirmBtn" class="btn-primary">
                        <i class="fas fa-arrow-right"></i> Dump
                    </button>
                    <button type="button" id="workspaceDumpCancelBtn" class="btn-secondary">
                        Cancel
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Background Image Selection Modal -->
    <div id="backgroundImageModal" class="modal">
        <div class="modal-content background-image-modal-content">
            <div class="modal-header">
                <h3>Select Background Image</h3>
                <button id="closeBackgroundImageModalBtn" class="close-dialog">&times;</button>
            </div>
            <div class="modal-body">
                <div class="background-image-search">
                    <input type="text" id="backgroundImageSearchInput" class="form-control" placeholder="Search images...">
                </div>
                <div class="background-image-options">
                    <button type="button" id="noBackgroundImageBtn" class="background-image-option no-image-option">
                        <div class="background-image-thumbnail no-image">
                            <i class="fas fa-times"></i>
                        </div>
                        <span class="background-image-name">No background image</span>
                    </button>
                </div>
                <div id="backgroundImageGrid" class="background-image-grid">
                    <!-- Thumbnails will be loaded here -->
                </div>
                <div id="backgroundImageLoading" class="background-image-loading" style="display: none;">
                    <div class="spinner"></div>
                    <p>Loading images...</p>
                </div>
                <div class="modal-actions">
                    <button type="button" id="backgroundImageCancelBtn" class="btn-secondary">
                        Cancel
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Hidden file input for image upload -->
    <input type="file" id="imageUploadInput" accept="image/*" style="display: none;">

    <!-- Confetti Container -->
    <div id="confettiContainer"></div>

    <!-- Toast Container -->
    <div id="toastContainer" class="toast-container"></div>

    <script src="script.js"></script>
</body>
</html> 