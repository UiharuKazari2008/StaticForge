const fs = require('fs');
const path = require('path');

// Metadata configuration for top-level categories
const categoryMetadata = {
  "attire": {
    prettyName: "Clothing & Attire",
    icon: "fa-shirt"
  },
  "body": {
    prettyName: "Body & Anatomy",
    icon: "fa-person"
  },
  "creatures": {
    prettyName: "Animals & Creatures",
    icon: "fa-paw"
  },
  "games": {
    prettyName: "Games & Entertainment",
    icon: "fa-gamepad"
  },
  "image": {
    prettyName: "Image & Composition",
    icon: "fa-image"
  },
  "more": {
    prettyName: "Miscellaneous",
    icon: "fa-ellipsis"
  },
  "objects": {
    prettyName: "Objects & Items",
    icon: "fa-cube"
  },
  "plants": {
    prettyName: "Plants & Nature",
    icon: "fa-seedling"
  },
  "rworld": {
    prettyName: "Real World",
    icon: "fa-globe"
  },
  "sex": {
    prettyName: "Adult Content",
    icon: "fa-heart"
  }
};

// Subcategory metadata for better organization
const subcategoryMetadata = {
  // Attire subcategories
  "sexual": { prettyName: "Intimate Wear", icon: "fa-heart" },
  "bra": { prettyName: "Bras", icon: "fa-female" },
  "panties": { prettyName: "Underwear", icon: "fa-female" },
  "eyewear": { prettyName: "Eyewear", icon: "fa-glasses" },
  "nudity": { prettyName: "Nude & Partial", icon: "fa-user" },
  "attire": { prettyName: "Regular Clothing", icon: "fa-tshirt" },
  "headwear": { prettyName: "Headwear", icon: "fa-hat" },
  "dress": { prettyName: "Dresses", icon: "fa-female" },
  "legwear": { prettyName: "Legwear", icon: "fa-socks" },
  "neckwear": { prettyName: "Neckwear", icon: "fa-scarf" },
  "sleeves": { prettyName: "Sleeves", icon: "fa-tshirt" },
  "swimsuit": { prettyName: "Swimwear", icon: "fa-swimming-pool" },
  
  // Body subcategories
  "bodyparts": { prettyName: "Body Parts", icon: "fa-user" },
  "ass": { prettyName: "Ass", icon: "fa-user" },
  "breasts": { prettyName: "Breasts", icon: "fa-female" },
  "face": { prettyName: "Face", icon: "fa-smile" },
  "eyes": { prettyName: "Eyes", icon: "fa-eye" },
  "ears": { prettyName: "Ears", icon: "fa-ear" },
  "hair": { prettyName: "Hair", icon: "fa-cut" },
  "haircolor": { prettyName: "Hair Colors", icon: "fa-palette" },
  "hairstyles": { prettyName: "Hair Styles", icon: "fa-cut" },
  "hands": { prettyName: "Hands", icon: "fa-hand" },
  "gestures": { prettyName: "Gestures", icon: "fa-hand-paper" },
  "neck": { prettyName: "Neck", icon: "fa-user" },
  "posture": { prettyName: "Posture", icon: "fa-user" },
  "pussy": { prettyName: "Pussy", icon: "fa-female" },
  "shoulders": { prettyName: "Shoulders", icon: "fa-user" },
  "skincolor": { prettyName: "Skin Colors", icon: "fa-palette" },
  "tail": { prettyName: "Tail", icon: "fa-paw" },
  "wings": { prettyName: "Wings", icon: "fa-feather" },
  "injury": { prettyName: "Injuries", icon: "fa-bandage" },
  
  // Creatures subcategories
  "animals": { prettyName: "Animals", icon: "fa-paw" },
  "birds": { prettyName: "Birds", icon: "fa-dove" },
  "cats": { prettyName: "Cats", icon: "fa-cat" },
  "dogs": { prettyName: "Dogs", icon: "fa-dog" },
  "legendary": { prettyName: "Legendary Creatures", icon: "fa-dragon" },
  
  // Games subcategories
  "activities": { prettyName: "Activities", icon: "fa-running" },
  "boardgames": { prettyName: "Board Games", icon: "fa-chess" },
  "sports": { prettyName: "Sports", icon: "fa-futbol" },
  "videogames": { prettyName: "Video Games", icon: "fa-gamepad" },
  
  // Image subcategories
  "alicense": { prettyName: "Alternative Versions", icon: "fa-magic" },
  "composition": { prettyName: "Composition", icon: "fa-camera" },
  "backgrounds": { prettyName: "Backgrounds", icon: "fa-image" },
  "censorship": { prettyName: "Censorship", icon: "fa-ban" },
  "colors": { prettyName: "Colors", icon: "fa-palette" },
  "focustags": { prettyName: "Focus Tags", icon: "fa-crosshairs" },
  "prints": { prettyName: "Prints", icon: "fa-print" },
  "styleparodies": { prettyName: "Style Parodies", icon: "fa-palette" },
  "text": { prettyName: "Text", icon: "fa-font" },
  "symbols": { prettyName: "Symbols", icon: "fa-star" },
  
  // More subcategories
  "family": { prettyName: "Family", icon: "fa-users" },
  "food": { prettyName: "Food & Drinks", icon: "fa-utensils" },
  "fire": { prettyName: "Fire", icon: "fa-fire" },
  "groups": { prettyName: "Groups", icon: "fa-users" },
  "phrases": { prettyName: "Phrases", icon: "fa-comment" },
  "scan": { prettyName: "Scan Quality", icon: "fa-search" },
  "water": { prettyName: "Water", icon: "fa-tint" },
  "subjective": { prettyName: "Subjective", icon: "fa-question" },
  "technology": { prettyName: "Technology", icon: "fa-microchip" },
  "verbs&gerunds": { prettyName: "Verbs & Gerunds", icon: "fa-language" },
  
  // Objects subcategories
  "weapons": { prettyName: "Weapons", icon: "fa-sword" },
  "audiotags": { prettyName: "Audio Tags", icon: "fa-volume-up" },
  "cards": { prettyName: "Cards", icon: "fa-credit-card" },
  "piercings": { prettyName: "Piercings", icon: "fa-gem" },
  "sexobjects": { prettyName: "Sex Toys", icon: "fa-heart" },
  
  // Plants subcategories
  "plant": { prettyName: "Plants", icon: "fa-seedling" },
  "tree": { prettyName: "Trees", icon: "fa-tree" },
  "flowers": { prettyName: "Flowers", icon: "fa-flower" },
  
  // Real World subcategories
  "celebrations": { prettyName: "Celebrations", icon: "fa-birthday-cake" },
  "jobs": { prettyName: "Jobs & Careers", icon: "fa-briefcase" },
  "locations": { prettyName: "Locations", icon: "fa-map-marker" },
  
  // Sex subcategories
  "acts": { prettyName: "Sexual Acts", icon: "fa-heart" },
  "positions": { prettyName: "Positions", icon: "fa-heart" }
};

// Array name mappings for better readability
const arrayNameMappings = {
  // Attire arrays
  "lingerie": "Lingerie Items",
  "bdsm": "BDSM Gear",
  "exposure": "Revealing Items",
  "misc": "Miscellaneous",
  "models": "Bra Types",
  "colors": "Color Variants",
  "patterns&prints": "Patterns & Prints",
  "appearance/colors": "Color Variants",
  "appearance/patterns&prints": "Patterns & Prints",
  "appearance/materials": "Materials",
  "appearance/incomplete": "Incomplete Items",
  "appearance/size": "Size Variants",
  "appearance/other": "Other Styles",
  "appearance/details": "Details & Features",
  "interaction/clothes": "Clothing Interactions",
  "interaction/bodyparts": "Body Interactions",
  "interaction/fluids": "Fluid Interactions",
  "eyewear/framecolors": "Frame Colors",
  "eyewear/lenscolors": "Lens Colors",
  "eyewear/types": "Eyewear Types",
  "eyewear/misc": "Eyewear Misc",
  "nude": "Nude States",
  "partial": "Partial Nudity",
  "head": "Head Accessories",
  "top": "Upper Body",
  "bottom": "Lower Body",
  "footwear": "Shoes & Boots",
  "accessories": "Accessories",
  "outfits": "Complete Outfits",
  "dress/types": "Dress Types",
  "dress/colors": "Dress Colors",
  "dress/patterns": "Dress Patterns",
  "dress/misc": "Dress Misc",
  "legwear/types": "Legwear Types",
  "legwear/colors": "Legwear Colors",
  "legwear/patterns": "Legwear Patterns",
  "legwear/misc": "Legwear Misc",
  "neckwear/types": "Neckwear Types",
  "neckwear/colors": "Neckwear Colors",
  "neckwear/misc": "Neckwear Misc",
  "sleeves/types": "Sleeve Types",
  "sleeves/colors": "Sleeve Colors",
  "sleeves/misc": "Sleeve Misc",
  "swimsuit/types": "Swimsuit Types",
  "swimsuit/colors": "Swimsuit Colors",
  "swimsuit/patterns": "Swimsuit Patterns",
  "swimsuit/misc": "Swimsuit Misc",
  
  // Body arrays
  "head": "Head Parts",
  "uppertorso": "Upper Torso",
  "lowertorso": "Lower Torso",
  "appendages": "Limbs",
  "types": "Body Types",
  "modifications": "Modifications",
  "ass/types": "Ass Types",
  "ass/colors": "Ass Colors",
  "ass/misc": "Ass Misc",
  "breasts/types": "Breast Types",
  "breasts/colors": "Breast Colors",
  "breasts/size": "Breast Sizes",
  "breasts/misc": "Breast Misc",
  "face/types": "Face Types",
  "face/colors": "Face Colors",
  "face/misc": "Face Misc",
  "eyes/types": "Eye Types",
  "eyes/colors": "Eye Colors",
  "eyes/misc": "Eye Misc",
  "ears/types": "Ear Types",
  "ears/colors": "Ear Colors",
  "ears/misc": "Ear Misc",
  "hair/types": "Hair Types",
  "hair/colors": "Hair Colors",
  "hair/styles": "Hair Styles",
  "hair/misc": "Hair Misc",
  "haircolor/types": "Hair Color Types",
  "hairstyles/types": "Hair Style Types",
  "hairstyles/misc": "Hair Style Misc",
  "hands/types": "Hand Types",
  "hands/colors": "Hand Colors",
  "hands/misc": "Hand Misc",
  "gestures/types": "Gesture Types",
  "gestures/misc": "Gesture Misc",
  "neck/types": "Neck Types",
  "neck/colors": "Neck Colors",
  "neck/misc": "Neck Misc",
  "posture/types": "Posture Types",
  "posture/misc": "Posture Misc",
  "pussy/types": "Genitalia Types",
  "pussy/colors": "Genitalia Colors",
  "pussy/misc": "Genitalia Misc",
  "shoulders/types": "Shoulder Types",
  "shoulders/colors": "Shoulder Colors",
  "shoulders/misc": "Shoulder Misc",
  "skincolor/types": "Skin Color Types",
  "tail/types": "Tail Types",
  "tail/colors": "Tail Colors",
  "tail/misc": "Tail Misc",
  "wings/types": "Wing Types",
  "wings/colors": "Wing Colors",
  "wings/misc": "Wing Misc",
  "injury/types": "Injury Types",
  "injury/misc": "Injury Misc",
  
  // Creatures arrays
  "categories": "Animal Categories",
  "types/insect": "Insects",
  "types/cat": "Felines",
  "types/dog": "Canines",
  "types/reptile|amphibian": "Reptiles & Amphibians",
  "types/fish": "Fish",
  "types/bird": "Birds",
  "types/mammal": "Mammals",
  "mythical": "Mythical Beings",
  "birds/types": "Bird Types",
  "birds/colors": "Bird Colors",
  "birds/misc": "Bird Misc",
  "cats/types": "Cat Types",
  "cats/colors": "Cat Colors",
  "cats/misc": "Cat Misc",
  "dogs/types": "Dog Types",
  "dogs/colors": "Dog Colors",
  "dogs/misc": "Dog Misc",
  "legendary/types": "Legendary Types",
  "legendary/misc": "Legendary Misc",
  
  // Games arrays
  "genres": "Game Genres",
  "platforms": "Gaming Platforms",
  "characters": "Game Characters",
  "equipment": "Sports Equipment",
  "teams": "Sports Teams",
  "activities/types": "Activity Types",
  "activities/misc": "Activity Misc",
  "boardgames/types": "Board Game Types",
  "boardgames/misc": "Board Game Misc",
  "sports/types": "Sport Types",
  "sports/equipment": "Sports Equipment",
  "sports/misc": "Sports Misc",
  "videogames/types": "Video Game Types",
  "videogames/platforms": "Gaming Platforms",
  "videogames/misc": "Video Game Misc",
  
  // Image arrays
  "major": "Major Alterations",
  "attire": "Costume Changes",
  "bodyparts": "Body Changes",
  "equipment": "Equipment Changes",
  "hair": "Hair Changes",
  "eyes": "Eye Changes",
  "personalities": "Personality Changes",
  "colors": "Color Changes",
  "age": "Age Changes",
  "other": "Other Changes",
  "viewangle": "View Angles",
  "perspective": "Perspective",
  "framing": "Framing",
  "lighting": "Lighting",
  "effects": "Visual Effects",
  "artstyles": "Art Styles",
  "mediums": "Art Mediums",
  "techniques": "Art Techniques",
  "alicense/types": "Alternative Types",
  "alicense/misc": "Alternative Misc",
  "composition/types": "Composition Types",
  "composition/misc": "Composition Misc",
  "backgrounds/types": "Background Types",
  "backgrounds/misc": "Background Misc",
  "censorship/types": "Censorship Types",
  "censorship/misc": "Censorship Misc",
  "colors/types": "Color Types",
  "colors/misc": "Color Misc",
  "focustags/types": "Focus Tag Types",
  "prints/types": "Print Types",
  "prints/misc": "Print Misc",
  "styleparodies/types": "Style Parody Types",
  "text/types": "Text Types",
  "text/misc": "Text Misc",
  "symbols/types": "Symbol Types",
  "symbols/misc": "Symbol Misc",
  
  // More arrays
  "terms": "Family Terms",
  "fruits": "Fruits",
  "vegetables": "Vegetables",
  "meats": "Meats",
  "drinks": "Beverages",
  "desserts": "Desserts",
  "dishes": "Dishes",
  "indoor": "Indoor Locations",
  "outdoor": "Outdoor Locations",
  "fantasy": "Fantasy Locations",
  "actions": "Actions",
  "emotions": "Emotions",
  "poses": "Poses",
  "family/types": "Family Types",
  "family/misc": "Family Misc",
  "food/types": "Food Types",
  "food/colors": "Food Colors",
  "food/misc": "Food Misc",
  "fire/types": "Fire Types",
  "fire/misc": "Fire Misc",
  "groups/types": "Group Types",
  "groups/misc": "Group Misc",
  "phrases/types": "Phrase Types",
  "phrases/misc": "Phrase Misc",
  "scan/types": "Scan Types",
  "scan/misc": "Scan Misc",
  "water/types": "Water Types",
  "water/misc": "Water Misc",
  "subjective/types": "Subjective Types",
  "subjective/misc": "Subjective Misc",
  "technology/types": "Technology Types",
  "technology/misc": "Technology Misc",
  
  // Objects arrays
  "swords": "Swords",
  "guns": "Firearms",
  "bows": "Bows & Arrows",
  "magical": "Magical Weapons",
  "chairs": "Chairs",
  "tables": "Tables",
  "beds": "Beds",
  "computers": "Computers",
  "phones": "Phones",
  "cameras": "Cameras",
  "cars": "Cars",
  "motorcycles": "Motorcycles",
  "aircraft": "Aircraft",
  "boats": "Boats",
  "weapons/types": "Weapon Types",
  "weapons/misc": "Weapon Misc",
  "audiotags/types": "Audio Tag Types",
  "audiotags/misc": "Audio Tag Misc",
  "cards/types": "Card Types",
  "cards/misc": "Card Misc",
  "piercings/types": "Piercing Types",
  "piercings/colors": "Piercing Colors",
  "piercings/misc": "Piercing Misc",
  "sexobjects/types": "Adult Object Types",
  "sexobjects/misc": "Adult Object Misc",
  
  // Plants arrays
  "deciduous": "Deciduous Trees",
  "evergreen": "Evergreen Trees",
  "wildflowers": "Wildflowers",
  "garden": "Garden Flowers",
  "medicinal": "Medicinal Herbs",
  "culinary": "Culinary Herbs",
  "plant/types": "Plant Types",
  "plant/colors": "Plant Colors",
  "plant/misc": "Plant Misc",
  "tree/types": "Tree Types",
  "tree/colors": "Tree Colors",
  "tree/misc": "Tree Misc",
  "flowers/types": "Flower Types",
  "flowers/colors": "Flower Colors",
  "flowers/misc": "Flower Misc",
  
  // Real World arrays
  "events": "Events",
  "newyear": "New Year",
  "cny": "Chinese New Year",
  "setsubun": "Setsubun",
  "valentines": "Valentine's Day",
  "hinamatsuri": "Hinamatsuri",
  "childrensday": "Children's Day",
  "summerfestival": "Summer Festival",
  "midautumn": "Mid-Autumn",
  "halloween": "Halloween",
  "christmas": "Christmas",
  "others": "Other Celebrations",
  "traditions": "Traditions",
  "customs": "Customs",
  "cities": "Cities",
  "landmarks": "Landmarks",
  "buildings": "Buildings",
  "celebrations/types": "Celebration Types",
  "celebrations/misc": "Celebration Misc",
  "jobs/types": "Job Types",
  "jobs/misc": "Job Misc",
  "locations/types": "Location Types",
  "locations/misc": "Location Misc",
  
  // Sex arrays
  "basic": "Basic Positions",
  "advanced": "Advanced Positions",
  "group": "Group Activities",
  "vibrators": "Vibrators",
  "dildos": "Dildos",
  "restraints": "Restraints",
  "clothing": "Sexy Clothing",
  "bodyparts": "Body Parts",
  "scenarios": "Scenarios",
  "acts/types": "Act Types",
  "acts/misc": "Act Misc",
  "positions/types": "Position Types",
  "positions/misc": "Position Misc",

  // Additional missing array names
  "1hand/1openfinger": "1 Hand 1 Open Finger",
  "1hand/2openfingers": "1 Hand 2 Open Fingers",
  "1hand/3openfingers": "1 Hand 3 Open Fingers",
  "1hand/variable": "1 Hand Variable",
  "1hand/wholeclosedhand": "1 Hand Whole Closed Hand",
  "1hand/wholeopenhand": "1 Hand Whole Open Hand",
  "2+characters": "2+ Characters",
  "2+hands": "2+ Hands",
  "3+characters": "3+ Characters",
  "abnormal": "Abnormal",
  "aboveneck": "Above Neck",
  "accs&parts": "Accessories & Parts",
  "accs/head": "Head Accessories",
  "accs/limbs": "Limb Accessories",
  "accs/neck": "Neck Accessories",
  "accs/torso": "Torso Accessories",
  "actions&activities": "Actions & Activities",
  "actions&locations": "Actions & Locations",
  "actions|posture": "Actions & Posture",
  "actions|states": "Actions & States",
  "ambiguous": "Ambiguous",
  "anatomy": "Anatomy",
  "animal": "Animal",
  "anthro&parts": "Anthro & Parts",
  "anus": "Anus",
  "appearance/inhuman": "Inhuman Appearance",
  "appearance/seriesspecific": "Series Specific Appearance",
  "appearance/stylistic": "Stylistic Appearance",
  "arms/basic": "Basic Arms",
  "arms/handpos": "Hand Position",
  "arms/handtouching": "Hand Touching",
  "arms/specific": "Specific Arms",
  "aroundeyes": "Around Eyes",
  "associated": "Associated",
  "attire/bare": "Bare Attire",
  "attire/normal": "Normal Attire",
  "backofhead": "Back of Head",
  "bands": "Bands",
  "before": "Before",
  "behaviors": "Behaviors",
  "blood": "Blood",
  "board": "Board",
  "body": "Body",
  "bondage": "Bondage",
  "breeds": "Breeds",
  "bycopyright": "By Copyright",
  "bydecade": "By Decade",
  "bydesign": "By Design",
  "bygender": "By Gender",
  "card": "Card",
  "carrying": "Carrying",
  "closed": "Closed",
  "clothes": "Clothes",
  "coatcolors": "Coat Colors",
  "collar": "Collar",
  "color": "Color",
  "colors/multiple": "Multiple Colors",
  "common": "Common",
  "comms": "Communications",
  "complete": "Complete",
  "components": "Components",
  "composition": "Composition",
  "condiments&spices": "Condiments & Spices",
  "containers": "Containers",
  "costumes": "Costumes",
  "covering": "Covering",
  "coveringbodyparts": "Covering Body Parts",
  "crowns": "Crowns",
  "culture": "Culture",
  "dairy": "Dairy",
  "defects": "Defects",
  "description": "Description",
  "descriptions": "Descriptions",
  "designtraits": "Design Traits",
  "details": "Details",
  "devices/other": "Other Devices",
  "devices/output": "Output Devices",
  "devices/players": "Player Devices",
  "devices/recorded": "Recorded Devices",
  "emotes": "Emotes",
  "emotions/negative": "Negative Emotions",
  "exception": "Exception",
  "explosives": "Explosives",
  "expressions": "Expressions",
  "facialhair": "Facial Hair",
  "fake": "Fake",
  "fetish/ageplay": "Age Play Fetish",
  "fetish/animalplay": "Animal Play Fetish",
  "fetish/bdsm": "BDSM Fetish",
  "fetish/bodytype": "Body Type Fetish",
  "fetish/breasts": "Breast Fetish",
  "fetish/cumplay": "Cum Play Fetish",
  "fetish/expression": "Expression Fetish",
  "fetish/genderplay": "Gender Play Fetish",
  "fetish/incest": "Incest Fetish",
  "fetish/moral": "Moral Fetish",
  "fetish/rape": "Rape Fetish",
  "fetish/role": "Role Fetish",
  "fetish/smother": "Smother Fetish",
  "fetish/view": "View Fetish",
  "fetishes/extreme": "Extreme Fetishes",
  "fetishes/misc": "Miscellaneous Fetishes",
  "fictional": "Fictional",
  "firearms/antique": "Antique Firearms",
  "firearms/futuristic": "Futuristic Firearms",
  "firearms/modern": "Modern Firearms",
  "flaws": "Flaws",
  "fluids": "Fluids",
  "focus": "Focus",
  "format": "Format",
  "frontofhead": "Front of Head",
  "gadgets/computers": "Computer Gadgets",
  "gadgets/holograms": "Hologram Gadgets",
  "gamerelated": "Game Related",
  "games": "Games",
  "gazes": "Gazes",
  "gender": "Gender",
  "genitalf": "Female Genitalia",
  "genitalm": "Male Genitalia",
  "geoshapes/2d": "2D Geometric Shapes",
  "geoshapes/3d": "3D Geometric Shapes",
  "gerunds": "Gerunds",
  "glasses": "Glasses",
  "greetings": "Greetings",
  "hand": "Hand",
  "hardware": "Hardware",
  "hats/brim": "Brimmed Hats",
  "hats/brimless": "Brimless Hats",
  "hats/earflaps": "Earflap Hats",
  "hats/misc": "Miscellaneous Hats",
  "hats/visor": "Visor Hats",
  "head&facial": "Head & Facial",
  "helmets": "Helmets",
  "hips": "Hips",
  "hugging": "Hugging",
  "inclination": "Inclination",
  "indoors": "Indoors",
  "ingame": "In Game",
  "insertion/basic": "Basic Insertion",
  "insertion/hand": "Hand Insertion",
  "insertion/sex": "Sexual Insertion",
  "instruments/brass": "Brass Instruments",
  "instruments/keyboard": "Keyboard Instruments",
  "instruments/other": "Other Instruments",
  "instruments/percussion": "Percussion Instruments",
  "instruments/string": "String Instruments",
  "instruments/woodwinds": "Woodwind Instruments",
  "interaction": "Interaction",
  "interaction/animals": "Animal Interaction",
  "interaction/arms": "Arm Interaction",
  "interaction/docking": "Docking Interaction",
  "interaction/feet": "Foot Interaction",
  "interaction/hand": "Hand Interaction",
  "interaction/head": "Head Interaction",
  "interaction/misc": "Miscellaneous Interaction",
  "interaction/mouth": "Mouth Interaction",
  "interaction/objects": "Object Interaction",
  "interaction/objects&acts": "Object & Act Interaction",
  "interaction/penis": "Penis Interaction",
  "interaction/people": "People Interaction",
  "interaction/toys": "Toy Interaction",
  "iris": "Iris",
  "jobs": "Jobs",
  "jobs&places": "Jobs & Places",
  "lackthereof": "Lack Thereof",
  "legs": "Legs",
  "legs/footposition": "Foot Position",
  "legs/kneelocation": "Knee Location",
  "legs/leglocation": "Leg Location",
  "length&styled": "Length & Styled",
  "length&volume": "Length & Volume",
  "litdevices": "Lit Devices",
  "lookingat": "Looking At",
  "male": "Male",
  "mealitems&misc": "Meal Items & Misc",
  "meat&seafood": "Meat & Seafood",
  "mecha": "Mecha",
  "mechanical": "Mechanical",
  "medical": "Medical",
  "melee": "Melee",
  "meme": "Meme",
  "metadata": "Metadata",
  "misc|actions": "Miscellaneous Actions",
  "movement": "Movement",
  "multiple": "Multiple",
  "musical": "Musical",
  "musicgenre": "Music Genre",
  "mythological": "Mythological",
  "nature": "Nature",
  "naughtypov": "Naughty POV",
  "neckwearstyles": "Neckwear Styles",
  "nonspecific": "Non Specific",
  "normal": "Normal",
  "notheadwear": "Not Headwear",
  "number": "Number",
  "objects": "Objects",
  "onbreasts": "On Breasts",
  "onlowerbody": "On Lower Body",
  "onmembers": "On Members",
  "onupperbody": "On Upper Body",
  "othercommon": "Other Common",
  "outdoors/manmade": "Man Made Outdoors",
  "outdoors/natural": "Natural Outdoors",
  "overbody": "Over Body",
  "palettes": "Palettes",
  "partial/abovechest": "Partial Above Chest",
  "partial/anyclothes": "Partial Any Clothes",
  "partial/ass|crotch": "Partial Ass & Crotch",
  "partial/breasts": "Partial Breasts",
  "partial/chest": "Partial Chest",
  "partial/legs|feet": "Partial Legs & Feet",
  "partial/nipples": "Partial Nipples",
  "partial/partofbreasts": "Partial Part of Breasts",
  "partial/specific": "Partial Specific",
  "partial/specific|multiple": "Partial Specific & Multiple",
  "partial/torso": "Partial Torso",
  "parts": "Parts",
  "parts&habitats": "Parts & Habitats",
  "patternedthings": "Patterned Things",
  "patterns": "Patterns",
  "patterns/other": "Other Patterns",
  "patterns/tradjp": "Traditional Japanese Patterns",
  "patterns|prints": "Patterns & Prints",
  "pieces": "Pieces",
  "place": "Place",
  "places": "Places",
  "playingcard": "Playing Card",
  "playingcardfaces/clubs": "Playing Card - Clubs",
  "playingcardfaces/diamonds": "Playing Card - Diamonds",
  "playingcardfaces/hearts": "Playing Card - Hearts",
  "playingcardfaces/spades": "Playing Card - Spades",
  "playingcardfaces/suits&ranks": "Playing Card - Suits & Ranks",
  "pointless": "Pointless",
  "position": "Position",
  "printitems": "Print Items",
  "prints": "Prints",
  "professions": "Professions",
  "pupils/color": "Pupil Color",
  "pupils/form": "Pupil Form",
  "puzzle": "Puzzle",
  "radio": "Radio",
  "ranged": "Ranged",
  "real": "Real",
  "related": "Related",
  "relatives": "Relatives",
  "restpoints": "Rest Points",
  "roadsigns": "Road Signs",
  "robots": "Robots",
  "samesex": "Same Sex",
  "scenes": "Scenes",
  "sclera": "Sclera",
  "screens": "Screens",
  "sex": "Sex",
  "sexual": "Sexual",
  "shoes": "Shoes",
  "signatureposes": "Signature Poses",
  "similar": "Similar",
  "sizes": "Sizes",
  "smile": "Smile",
  "smug": "Smug",
  "somewhereelse": "Somewhere Else",
  "sources": "Sources",
  "space": "Space",
  "species": "Species",
  "specific": "Specific",
  "specific pieces": "Specific Pieces",
  "sports": "Sports",
  "starches": "Starches",
  "stimulation/feet": "Foot Stimulation",
  "stimulation/frottage": "Frottage Stimulation",
  "stimulation/groping": "Groping Stimulation",
  "stimulation/hair": "Hair Stimulation",
  "stimulation/masturbation": "Masturbation Stimulation",
  "stimulation/oral": "Oral Stimulation",
  "stimulation/tail": "Tail Stimulation",
  "strange": "Strange",
  "styles": "Styles",
  "styles/long": "Long Styles",
  "styles/medium": "Medium Styles",
  "styles/patterns": "Style Patterns",
  "styles/prints": "Style Prints",
  "styles/short": "Short Styles",
  "styles/tall": "Tall Styles",
  "styles/tied": "Tied Styles",
  "styles/tradmedium": "Traditional Medium Styles",
  "subjectmatter": "Subject Matter",
  "suits": "Suits",
  "sunglasses": "Sunglasses",
  "sweets&snacks&desserts": "Sweets & Snacks & Desserts",
  "swimsuits|bodysuits": "Swimsuits & Bodysuits",
  "text&punctuation": "Text & Punctuation",
  "texture": "Texture",
  "themes": "Themes",
  "tools": "Tools",
  "topofhead": "Top of Head",
  "touchingclothes": "Touching Clothes",
  "toys": "Toys",
  "traditional": "Traditional",
  "traits": "Traits",
  "trims": "Trims",
  "type": "Type",
  "types/aquaticinvertebrate": "Aquatic Invertebrate Types",
  "types/cambrian": "Cambrian Types",
  "types/crustacean": "Crustacean Types",
  "types/elemental": "Elemental Types",
  "types/false": "False Types",
  "types/insects": "Insect Types",
  "types/large": "Large Types",
  "types/mammals": "Mammal Types",
  "types/other": "Other Types",
  "types/otheranimals": "Other Animal Types",
  "types/rodent": "Rodent Types",
  "types/small|med": "Small & Medium Types",
  "types/supernatural": "Supernatural Types",
  "types/whale": "Whale Types",
  "underclothes": "Underclothes",
  "utensils&utilities": "Utensils & Utilities",
  "vegetable": "Vegetable",
  "vehicles": "Vehicles",
  "verbs": "Verbs",
  "visibility/parts": "Visibility Parts",
  "visibility/whole": "Visibility Whole",
  "visibleparts": "Visible Parts",
  "visiblesigns": "Visible Signs",
  "visual": "Visual",
  "wet": "Wet",
  "wholebody": "Whole Body"
};

// Array icon mappings for better UI display
const arrayIconMappings = {
  // Creatures arrays
  "categories": "fa-list",
  "types/insect": "fa-bug",
  "types/cat": "fa-cat",
  "types/dog": "fa-dog",
  "types/reptile|amphibian": "fa-dragon",
  "types/fish": "fa-fish",
  "types/bird": "fa-dove",
  "types/mammal": "fa-paw",
  "mythical": "fa-magic",
  "birds/types": "fa-dove",
  "birds/colors": "fa-palette",
  "birds/misc": "fa-dove",
  "cats/types": "fa-cat",
  "cats/colors": "fa-palette",
  "cats/misc": "fa-cat",
  "dogs/types": "fa-dog",
  "dogs/colors": "fa-palette",
  "dogs/misc": "fa-dog",
  "legendary/types": "fa-dragon",
  "legendary/misc": "fa-dragon",
  
  // Games arrays
  "genres": "fa-gamepad",
  "platforms": "fa-desktop",
  "characters": "fa-user",
  "equipment": "fa-trophy",
  "teams": "fa-users",
  "activities/types": "fa-running",
  "activities/misc": "fa-running",
  "boardgames/types": "fa-chess",
  "boardgames/misc": "fa-chess",
  "sports/types": "fa-futbol",
  "sports/equipment": "fa-trophy",
  "sports/misc": "fa-futbol",
  "videogames/types": "fa-gamepad",
  "videogames/platforms": "fa-desktop",
  "videogames/misc": "fa-gamepad",
  
  // Image arrays
  "major": "fa-magic",
  "attire": "fa-tshirt",
  "bodyparts": "fa-user",
  "equipment": "fa-tools",
  "hair": "fa-cut",
  "eyes": "fa-eye",
  "personalities": "fa-smile",
  "colors": "fa-palette",
  "age": "fa-birthday-cake",
  "other": "fa-ellipsis",
  "viewangle": "fa-camera",
  "perspective": "fa-camera",
  "framing": "fa-crop",
  "lighting": "fa-lightbulb",
  "effects": "fa-magic",
  "artstyles": "fa-palette",
  "mediums": "fa-paint-brush",
  "techniques": "fa-paint-brush",
  "alicense/types": "fa-magic",
  "alicense/misc": "fa-magic",
  "composition/types": "fa-camera",
  "composition/misc": "fa-camera",
  "backgrounds/types": "fa-image",
  "backgrounds/misc": "fa-image",
  "censorship/types": "fa-ban",
  "censorship/misc": "fa-ban",
  "colors/types": "fa-palette",
  "colors/misc": "fa-palette",
  "focustags/types": "fa-crosshairs",
  "prints/types": "fa-print",
  "prints/misc": "fa-print",
  "styleparodies/types": "fa-palette",
  "text/types": "fa-font",
  "text/misc": "fa-font",
  "symbols/types": "fa-star",
  "symbols/misc": "fa-star",
  
  // More arrays
  "terms": "fa-users",
  "fruits": "fa-apple-alt",
  "vegetables": "fa-carrot",
  "meats": "fa-drumstick-bite",
  "drinks": "fa-wine-glass",
  "desserts": "fa-ice-cream",
  "dishes": "fa-utensils",
  "indoor": "fa-home",
  "outdoor": "fa-tree",
  "fantasy": "fa-magic",
  "actions": "fa-running",
  
  // Body arrays
  "main": "fa-user",
  "anatomy": "fa-user",
  "sizes": "fa-ruler",
  "scenes": "fa-image",
  "visibility/parts": "fa-eye",
  "visibility/whole": "fa-eye",
  "description": "fa-tag",
  "clothing": "fa-tshirt",
  "interaction/penis": "fa-hand",
  "interaction/head": "fa-hand",
  "interaction/mouth": "fa-hand",
  "interaction/hand": "fa-hand",
  "interaction/fluids": "fa-tint",
  "interaction/objects&acts": "fa-hand",
  "emotions": "fa-smile",
  "sexual": "fa-heart",
  "smile": "fa-smile",
  "smug": "fa-smile",
  "emotions/negative": "fa-frown",
  "emotes": "fa-smile",
  "styles": "fa-palette",
  "misc": "fa-ellipsis",
  "lookingat": "fa-eye",
  "iris": "fa-eye",
  "pupils/color": "fa-eye",
  "pupils/form": "fa-eye",
  "sclera": "fa-eye",
  "aroundeyes": "fa-eye",
  "appearance/inhuman": "fa-eye",
  "appearance/stylistic": "fa-eye",
  "appearance/seriesspecific": "fa-eye",
  "appearance/other": "fa-eye",
  "number": "fa-hashtag",
  "animal": "fa-paw",
  "other": "fa-ellipsis",
  "objects": "fa-cube",
  "actions": "fa-hand",
  "facialhair": "fa-cut",
  "fantasy": "fa-magic",
  "length&volume": "fa-cut",
  "styles/short": "fa-cut",
  "styles/medium": "fa-cut",
  "styles/long": "fa-cut",
  "styles/tied": "fa-cut",
  "styles/tall": "fa-cut",
  "texture": "fa-cut",
  "frontofhead": "fa-cut",
  "topofhead": "fa-cut",
  "backofhead": "fa-cut",
  "aboveneck": "fa-hand",
  "onupperbody": "fa-hand",
  "onbreasts": "fa-hand",
  "onlowerbody": "fa-hand",
  "onmembers": "fa-hand",
  "somewhereelse": "fa-hand",
  "strange": "fa-hand",
  "2+hands": "fa-hands",
  "1hand/1openfinger": "fa-hand",
  "1hand/2openfingers": "fa-hand",
  "1hand/3openfingers": "fa-hand",
  "1hand/wholeopenhand": "fa-hand",
  "1hand/wholeclosedhand": "fa-hand",
  "1hand/variable": "fa-hand",
  "attire/normal": "fa-tshirt",
  "attire/bare": "fa-user",
  "interaction/objects": "fa-hand",
  "interaction/arms": "fa-hand",
  "interaction/people": "fa-hand",
  "interaction/animals": "fa-hand",
  "interaction/misc": "fa-hand",
  "normal": "fa-palette",
  "abnormal": "fa-palette",
  "related": "fa-palette",
  "types/supernatural": "fa-magic",
  "types/elemental": "fa-fire",
  "types/mammals": "fa-paw",
  "types/otheranimals": "fa-paw",
  "types/insects": "fa-bug",
  "types/false": "fa-times",
  "types/other": "fa-ellipsis",
  "position": "fa-arrows-alt",
  "visiblesigns": "fa-eye",
  "blood": "fa-tint",
  "covering": "fa-bandage",
  
  // Attire arrays
  "lingerie": "fa-heart",
  "bdsm": "fa-heart",
  "exposure": "fa-user",
  "models": "fa-female",
  "colors": "fa-palette",
  "patterns&prints": "fa-palette",
  "eyewear/framecolors": "fa-palette",
  "eyewear/lenscolors": "fa-palette",
  "eyewear/types": "fa-glasses",
  "eyewear/misc": "fa-glasses",
  "glasses": "fa-glasses",
  "sunglasses": "fa-glasses",
  "complete": "fa-user",
  "bygender": "fa-user",
  "partial/anyclothes": "fa-user",
  "partial/specific|multiple": "fa-user",
  "partial/abovechest": "fa-user",
  "partial/chest": "fa-user",
  "partial/breasts": "fa-user",
  "partial/partofbreasts": "fa-user",
  "partial/nipples": "fa-user",
  "partial/torso": "fa-user",
  "partial/ass|crotch": "fa-user",
  "partial/legs": "fa-user",
  "partial/arms": "fa-user",
  "partial/head": "fa-user",
  "partial/face": "fa-user",
  "partial/eyes": "fa-user",
  "partial/mouth": "fa-user",
  "partial/hands": "fa-user",
  "partial/feet": "fa-user",
  "partial/misc": "fa-user",
  "head": "fa-hat",
  "top": "fa-tshirt",
  "bottom": "fa-tshirt",
  "legs": "fa-socks",
  "shoes": "fa-shoe-prints",
  "costumes": "fa-mask",
  "swimsuits|bodysuits": "fa-swimming-pool",
  "traditional": "fa-flag",
  "accs/head": "fa-hat",
  "accs/neck": "fa-scarf",
  "accs/arms": "fa-bracelet",
  "accs/legs": "fa-socks",
  "accs/misc": "fa-ellipsis",
  "types": "fa-ellipsis",
  "colors": "fa-palette",
  "hats/visor": "fa-hat",
  "hats/brim": "fa-hat",
  "hats/earflaps": "fa-hat",
  "hats/brimless": "fa-hat",
  "hats/misc": "fa-hat",
  "helmets": "fa-helmet",
  "crowns": "fa-crown",
  "other": "fa-ellipsis",
  "misc|actions": "fa-ellipsis",
  "patterns|prints": "fa-palette",
  "details": "fa-ellipsis",
  "length&styled": "fa-ruler",
  "trims": "fa-ellipsis",
  "styles": "fa-ellipsis",
  "actions": "fa-hand",
  "lackthereof": "fa-times",
  "male": "fa-male",
  "other": "fa-ellipsis",
  
  // Objects arrays
  "explosives": "fa-bomb",
  "firearms/antique": "fa-gun",
  "firearms/modern": "fa-gun",
  "firearms/futuristic": "fa-gun",
  "melee": "fa-sword",
  "ranged": "fa-bow-arrow",
  "design": "fa-palette",
  "accs&parts": "fa-tools",
  "devices/players": "fa-play",
  "devices/output": "fa-volume-up",
  "devices/recorded": "fa-microphone",
  "devices/other": "fa-ellipsis",
  "instruments/brass": "fa-music",
  "instruments/percussion": "fa-music",
  "instruments/string": "fa-music",
  "instruments/woodwinds": "fa-music",
  "instruments/keyboard": "fa-music",
  "instruments/other": "fa-music",
  "main": "fa-credit-card",
  "types": "fa-credit-card",
  "color": "fa-palette",
  "gamerelated": "fa-gamepad",
  "playingcardfaces/suits&ranks": "fa-credit-card",
  "playingcardfaces/clubs": "fa-credit-card",
  "playingcardfaces/diamonds": "fa-credit-card",
  "playingcardfaces/hearts": "fa-credit-card",
  "playingcardfaces/spades": "fa-credit-card",
  "main": "fa-gem",
  "head&facial": "fa-gem",
  "body": "fa-gem",
  "genitalf": "fa-gem",
  "genitalm": "fa-gem",
  "toys": "fa-heart",
  "bdsm": "fa-heart",
  "fluids": "fa-tint",
  
  // Plants arrays
  "types": "fa-seedling",
  "parts": "fa-seedling",
  "actions&locations": "fa-seedling",
  "parts&habitats": "fa-tree",
  "misc": "fa-tree",
  "actions": "fa-tree",
  "species": "fa-flower",
  "fictional": "fa-flower",
  
  // Real world arrays
  "events": "fa-calendar",
  "newyear": "fa-calendar",
  "cny": "fa-calendar",
  "setsubun": "fa-calendar",
  "valentines": "fa-heart",
  "hinamatsuri": "fa-calendar",
  "childrensday": "fa-calendar",
  "summerfestival": "fa-calendar",
  "midautumn": "fa-calendar",
  "halloween": "fa-calendar",
  "christmas": "fa-calendar",
  "main": "fa-briefcase",
  "indoors": "fa-home",
  "outdoors/natural": "fa-tree",
  "outdoors/manmade": "fa-building",
  "buildings": "fa-building",
  "fictional": "fa-magic",
  "other": "fa-ellipsis",
  
  // Sex arrays
  "before": "fa-heart",
  "stimulation/feet": "fa-heart",
  "stimulation/frottage": "fa-heart",
  "stimulation/groping": "fa-heart",
  "stimulation/hair": "fa-heart",
  "stimulation/masturbation": "fa-heart",
  "stimulation/tail": "fa-heart",
  "stimulation/oral": "fa-heart",
  "group": "fa-users",
  "insertion/basic": "fa-heart",
  "insertion/objects": "fa-heart",
  "insertion/bodyparts": "fa-heart",
  "insertion/misc": "fa-heart",
  "positions/basic": "fa-heart",
  "positions/advanced": "fa-heart",
  "positions/misc": "fa-heart",
  "fluids": "fa-tint",
  "bodyparts": "fa-user",
  "objects": "fa-cube",
  "misc": "fa-heart",
  "main": "fa-heart",
  "bondage": "fa-heart",
  
  // Technology arrays
  "themes": "fa-microchip",
  "robots": "fa-robot",
  "mecha": "fa-robot",
  "bodyparts": "fa-microchip",
  "gadgets/computers": "fa-laptop",
  "gadgets/holograms": "fa-hologram",
  "comms": "fa-phone",
  "radio": "fa-radio",
  "vehicles": "fa-car",
  "suits": "fa-user-astronaut",
  "weapons": "fa-gun",
  "tools": "fa-tools",
  "misc": "fa-microchip",
  
  // Water arrays
  "wet": "fa-tint",
  "nature": "fa-water",
  "clothes": "fa-tshirt",
  "vehicles": "fa-ship",
  "misc": "fa-tint",
  
  // Verbs arrays
  "verbs": "fa-language",
  "gerunds": "fa-language",
  "ambiguous": "fa-language",
  
  // Fire arrays
  "bodyparts": "fa-fire",
  "colors": "fa-fire",
  "actions": "fa-fire",
  "objects": "fa-fire",
  "misc": "fa-fire",
  
  // Groups arrays
  "bygender": "fa-users",
  
  // Phrases arrays
  "greetings": "fa-comment",
  "othercommon": "fa-comment",
  "meme": "fa-comment",
  
  // Scan arrays
  "defects": "fa-search",
  "sources": "fa-search",
  "others": "fa-search",
  
  // Subjective arrays
  "common": "fa-question",
  "exception": "fa-question",
  
  // Food arrays
  "fruits": "fa-apple-alt",
  "vegetable": "fa-carrot",
  "meat&seafood": "fa-drumstick-bite",
  "starches": "fa-bread-slice",
  "dairy": "fa-cheese",
  "sweets&snacks&desserts": "fa-ice-cream",
  "condiments&spices": "fa-pepper-hot",
  "mealitems&misc": "fa-utensils",
  "drinks": "fa-wine-glass",
  "containers": "fa-box",
  "preparation": "fa-utensils",
  "cooking": "fa-fire",
  "serving": "fa-utensils",
  "eating": "fa-utensils",
  
  // Celebrations arrays
  "events": "fa-calendar",
  "newyear": "fa-calendar",
  "cny": "fa-calendar",
  "setsubun": "fa-calendar",
  "valentines": "fa-heart",
  "hinamatsuri": "fa-calendar",
  "childrensday": "fa-calendar",
  "summerfestival": "fa-calendar",
  "midautumn": "fa-calendar",
  "halloween": "fa-calendar",
  "christmas": "fa-calendar",
  
  // Jobs arrays
  "main": "fa-briefcase",
  
  // Locations arrays
  "indoors": "fa-home",
  "outdoors/natural": "fa-tree",
  "outdoors/manmade": "fa-building",
  "buildings": "fa-building",
  "fictional": "fa-magic",
  "other": "fa-ellipsis",
  
  // Sex acts arrays
  "before": "fa-heart",
  "stimulation/feet": "fa-heart",
  "stimulation/frottage": "fa-heart",
  "stimulation/groping": "fa-heart",
  "stimulation/hair": "fa-heart",
  "stimulation/masturbation": "fa-heart",
  "stimulation/tail": "fa-heart",
  "stimulation/oral": "fa-heart",
  "group": "fa-users",
  "insertion/basic": "fa-heart",
  "insertion/objects": "fa-heart",
  "insertion/bodyparts": "fa-heart",
  "insertion/misc": "fa-heart",
  "positions/basic": "fa-heart",
  "positions/advanced": "fa-heart",
  "positions/misc": "fa-heart",
  "fluids": "fa-tint",
  "bodyparts": "fa-user",
  "objects": "fa-cube",
  "misc": "fa-heart",
  
  // Sex positions arrays
  "main": "fa-heart",
  "bondage": "fa-heart",
  
  // Default for any unmapped arrays
  "default": "fa-tag"
};

function addMetadataToObject(obj, path = []) {
  const result = {};
  
  for (const [key, value] of Object.entries(obj)) {
    if (Array.isArray(value)) {
      // This is a final array of tags
      result[key] = value;
    } else if (typeof value === 'object' && value !== null) {
      // This is a nested object (category or subcategory)
      const processedValue = addMetadataToObject(value, [...path, key]);
      
      // Check if this is a subcategory (path.length === 1 means we're at subcategory level)
      if (path.length === 1) {
        const subcategoryKey = key; // The current key is the subcategory name
        const metadata = subcategoryMetadata[subcategoryKey];
        if (metadata) {
          processedValue._metadata = {
            prettyName: metadata.prettyName,
            icon: metadata.icon,
            arrayNames: processedValue._metadata ? processedValue._metadata.arrayNames : {},
            arrayIcons: processedValue._metadata ? processedValue._metadata.arrayIcons : {}
          };
        }
      }
      
      result[key] = processedValue;
    }
  }
  
  // Add metadata if this is a top-level category or subcategory
  if (path.length === 0) {
    // Top-level category - add metadata to each top-level key
    for (const [key, value] of Object.entries(obj)) {
      if (typeof value === 'object' && !Array.isArray(value)) {
        const metadata = categoryMetadata[key];
        if (metadata) {
          result[key]._metadata = {
            prettyName: metadata.prettyName,
            icon: metadata.icon,
            arrayNames: {}
          };
          
          // Add array names and icons for direct arrays under this category
          for (const [arrayKey, arrayValue] of Object.entries(value)) {
            if (Array.isArray(arrayValue)) {
              if (arrayNameMappings[arrayKey]) {
                result[key]._metadata.arrayNames[arrayKey] = arrayNameMappings[arrayKey];
              }
              if (arrayIconMappings[arrayKey]) {
                if (!result[key]._metadata.arrayIcons) {
                  result[key]._metadata.arrayIcons = {};
                }
                result[key]._metadata.arrayIcons[arrayKey] = arrayIconMappings[arrayKey];
              }
            }
          }
        }
      }
    }

  } else if (path.length >= 2) {
    // Deeper nested category - add array names and icons if there are arrays
    const hasArrays = Object.values(obj).some(v => Array.isArray(v));
    if (hasArrays) {
      result._metadata = {
        arrayNames: {},
        arrayIcons: {}
      };
      
      for (const [key, value] of Object.entries(obj)) {
        if (Array.isArray(value)) {
          if (arrayNameMappings[key]) {
            result._metadata.arrayNames[key] = arrayNameMappings[key];
          }
          if (arrayIconMappings[key]) {
            result._metadata.arrayIcons[key] = arrayIconMappings[key];
          }
        }
      }
    }
  }
  
  return result;
}

function updateDatasetTagGroups() {
  try {
    console.log('Reading dataset tag groups file...');
    const filePath = path.join(__dirname, 'dataset_tag_groups.json');
    const data = fs.readFileSync(filePath, 'utf8');
    const datasetGroups = JSON.parse(data);
    
    console.log('Adding metadata to dataset groups...');
    const updatedGroups = addMetadataToObject(datasetGroups);
    
    console.log('Writing updated dataset groups...');
    const outputPath = path.join(__dirname, 'dataset_tag_groups_updated.json');
    fs.writeFileSync(outputPath, JSON.stringify(updatedGroups, null, 2), 'utf8');
    
    console.log(`✅ Successfully updated dataset tag groups with metadata!`);
    console.log(`📁 Output file: ${outputPath}`);
    console.log(`📊 Added metadata for ${Object.keys(categoryMetadata).length} top-level categories`);
    console.log(`🔧 Added metadata for ${Object.keys(subcategoryMetadata).length} subcategories`);
    console.log(`🏷️  Added array names for ${Object.keys(arrayNameMappings).length} arrays`);
    
  } catch (error) {
    console.error('❌ Error updating dataset tag groups:', error.message);
    process.exit(1);
  }
}

// Run the update
updateDatasetTagGroups(); 